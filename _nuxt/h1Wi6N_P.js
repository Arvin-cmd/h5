import{u as qe,_ as He,s as Le}from"./oLmhSPqQ.js";import{v as Pe,aq as ve,b9 as he,as as Se,aj as De,r as I,bt as Re,c as _,be as je,bu as fe,bb as We,ay as Ve,bv as pe,bw as ze,bl as Qe,q as w,bq as Ke,x as Oe,bx as Ye,by as Ee,bz as Je,m as c,n as a,y as e,p as o,J as Ge,K as Xe,bA as ge,w as O,ax as Y,I as R,F as j,z as E,o as u,aw as Ze}from"./RL1ig8FZ.js";import{c as et,Q as tt,u as at,s as nt,a as st,b as ot}from"./CdHsbEjU.js";import{a as lt,_ as rt}from"./BVk2C0Ud.js";import{p as be,c as ut,a as _e,b as ye,f as we,s as xe,d as it}from"./DhXQRDnN.js";import{t as dt,b as ke}from"./D8S4GKic.js";import{u as ct}from"./NnSjaIu3.js";import{u as mt}from"./FKcu2zTh.js";import{a as vt}from"./eWe1y3MY.js";import{u as ht}from"./BgN8Fqc1.js";import{_ as ft}from"./DlAUqK2U.js";import"./DBGHBmPk.js";const pt={height:he(0),anchors:Se(),duration:he(.3),contentDraggable:ve,lockScroll:Boolean,safeAreaInsetBottom:ve},[gt,W]=De("floating-panel");var bt=Pe({name:gt,props:pt,emits:["heightChange","update:height"],setup(h,{emit:t,slots:C}){const m=I(),U=I(),p=Re(()=>+h.height,i=>t("update:height",i)),v=_(()=>{var i,f;return{min:(i=h.anchors[0])!=null?i:100,max:(f=h.anchors[h.anchors.length-1])!=null?f:Math.round(je.value*.6)}}),q=_(()=>h.anchors.length>=2?h.anchors:[v.value.min,v.value.max]),r=I(!1),J=_(()=>({height:fe(v.value.max),transform:`translateY(calc(100% + ${fe(-p.value)}))`,transition:r.value?"none":`transform ${h.duration}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`})),V=i=>{const f=Math.abs(i),{min:k,max:l}=v.value;return f>l?-(l+(f-l)*.2):f<k?-(k-(k-f)*.2):i};let B,x=-1;const F=We(),H=i=>{F.start(i),r.value=!0,B=-p.value,x=-1},G=i=>{var f;F.move(i);const k=i.target;if(U.value===k||(f=U.value)!=null&&f.contains(k)){const{scrollTop:d}=U.value;if(x=Math.max(x,d),!h.contentDraggable)return;if(-B<v.value.max)Ke(i,!0);else if(!(d<=0&&F.deltaY.value>0)||x>0)return}const l=F.deltaY.value+B;p.value=-V(l)},T=()=>{x=-1,r.value=!1,p.value=pe(q.value,p.value),p.value!==-B&&t("heightChange",{height:p.value})};Ve(v,()=>{p.value=pe(q.value,p.value)},{immediate:!0}),ze(m,()=>h.lockScroll||r.value),Qe("touchmove",G,{target:m});const z=()=>C.header?C.header():w("div",{class:W("header")},[w("div",{class:W("header-bar")},null)]);return()=>{var i;return w("div",{class:[W(),{"van-safe-area-bottom":h.safeAreaInsetBottom}],ref:m,style:J.value,onTouchstartPassive:H,onTouchend:T,onTouchcancel:T},[z(),w("div",{class:W("content"),ref:U},[(i=C.default)==null?void 0:i.call(C)])])}}});function Ne(h,t){return et(tt,h)}const _t={class:"h-screen flex flex-col font-[dinpro]"},yt={class:"bg-[#2A2B30] mb-0 rounded-lg overflow-hidden m-3 border-bg"},wt={class:"relative"},xt={class:"py-2 px-3 home-bg flex justify-between"},kt={class:"px-3 py-2 flex"},Nt=["src"],Pt={key:1,class:"w-20 h-20 animate-pulse rounded-full bg-white/50"},It={class:"pl-3 text-sm text-white/80 flex-1 grid grid-cols-2 content-start"},Ct={class:""},At={class:"text-right"},Ut={class:""},Bt={class:"text-right"},Ft={class:"text-theme"},Tt={key:0,class:"flex items-center justify-between mt-1 col-span-2"},Mt={class:"font-bold text-lg rounded-full lucky w-8 h-8 flex items-center justify-center"},$t={class:"text-lg font-bold p-3"},qt={class:"flex-1 px-3"},Ht={class:"flex justify-between mb-2"},Lt={class:"divide-y divide-[#2A2B30] text-white/80"},St={class:"px-3 py-2"},Dt={class:"flex items-center border border-white/20 rounded-lg py-1 px-2 mb-3"},Rt=["src"],jt={class:"grid grid-cols-3 gap-2 mb-3"},Wt=["onClick"],Vt={class:"text-xs mb-3"},zt=["disabled"],Qt={key:1},Kt=["disabled"],Ot={key:1},Yt=Pe({__name:"info",setup(h){const{t}=Oe(),{address:C}=qe();vt({title:"UU"+t("竞拍")+" - "+t("专属竞拍详情"),ogTitle:"UU"+t("竞拍")+" | "+t("竞争激烈的实时下注"),description:t("参与")+"UU"+t("去中心化竞拍")+"，"+t("查看实时下注情况")+"，"+t("计算获胜概率")+"，"+t("随时掌握竞拍动态")+"。",ogDescription:t("正在进行中的热门竞拍")+"！"+t("查看实时下注情况")+"，"+t("计算您的中奖概率")+"。"+t("在")+"UU"+t("竞拍平台")+"，"+t("小额投入也有机会赢取")+"ETH"+t("和热门代币")+"，"+t("透明公正的链上竞争")+"，"+t("立即参与")+"！"});const $=Ye(),m=ct(),{tokenAddressMap:U}=dt(),{addBetRecord:p}=ht(),v=_(()=>BigInt($.query.id||0)),q=_(()=>n=>{var g;const s=Number(((g=r.value)==null?void 0:g.drawNum)||0);return s>=n.startWeight&&s<=n.endWeight?"lucky rounded border-none text-black":""}),{data:r,isLoading:J,refetch:V}=Ne({queryKey:_(()=>["auctionInfo",$.query.id]),queryFn:async()=>{const n={user:"",award:"",total:0,pour:0,drawNum:0},s=await m.auctionInfo(v.value);return n.user=s[0],n.award=s[1],n.total=Number(s[2]),n.pour=Number(s[3]),s[2]==s[3]&&(n.drawNum=Number(await m.drawNum(v.value))),n}}),B=_(()=>!r.value||!x.value?0:Number(x.value||0)/(Number(r.value.total)||1)*100),{data:x,refetch:F}=Ne({queryKey:_(()=>["pourNum",$.query.id]),queryFn:async()=>m.pourNum(v.value,C.value),enabled:_(()=>!!C.value)}),{data:H,isPending:G,refetch:T,isRefetching:z,isFetching:i,hasNextPage:f,fetchNextPage:k}=at({queryKey:_(()=>["getPourList"]),refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:n=>n.nextCursor,queryFn:async({pageParam:n=1})=>{const s=20n,g=await m.getPourList(v.value,BigInt(n),s),N={list:g[1].map((A,te)=>({...A,amount:Number(A.amount),startWeight:0,endWeight:0})),nextCursor:void 0};let D=0;return N.list=N.list.map(A=>({...A,startWeight:D+1,endWeight:D+=A.amount})),(n-1)*Number(s)+g[1].length<Number(g[0])&&(N.nextCursor=n+1),N}}),l=I(mt("UB")),d=I(null),M=I(!1),L=[100,300],S=I(L[0]),Ie=I([1,5,10,50,100,500]),{setShowMenu:Q}=Ee();l.value.balanceOf(),l.value.allowance(m.address.value);const Ce=_(()=>l.value.allowanceMap[m.address.value]||0n>=be(d.value||0,l.value.tokenInfo.decimals)),{isPending:X,mutateAsync:Ae}=ke({mutationFn:async n=>{await l.value.approve(m.address.value,be(n,l.value.tokenInfo.decimals)),await l.value.allowance(m.address.value)}}),Ue=()=>{Q(!1),S.value=L[1]},Be=({height:n})=>{Q(n==L[0])};Je(()=>{Q(!0)});const{isPending:Z,mutateAsync:Fe}=ke({mutationFn:async()=>{var s,g;if(we(l.value.balance,l.value.tokenInfo.decimals)<Number(d.value||0)){xe("余额不足");return}if(Number((s=r.value)==null?void 0:s.total)-Number((g=r.value)==null?void 0:g.pour)<Number(d.value||0)){xe("剩余数量不足");return}const n=it({message:t("确认中")+"...",duration:0});try{M.value=!1,await m.pourAuction(BigInt(v.value),BigInt(d.value||0)),p(Number(v.value)),d.value=null,V(),T(),F(),l.value.balanceOf(),l.value.allowance(m.address.value),n.open({type:"success",message:t("下注成功"),duration:2e3})}catch(N){n.open({type:"error",message:N.shortMessage||t("下注失败"),duration:2e3})}}});return(n,s)=>{var ne,se,oe,le,re,ue,ie,de;const g=He,N=Xe,D=st,ee=ot,A=nt,te=rt,ae=Le,Te=bt,Me=lt;return u(),c("div",_t,[w(g,{title:e(t)("详情")},null,8,["title"]),a("div",yt,[a("div",wt,[a("div",xt,[a("span",null,"# "+o(e(v)),1),a("span",{onClick:s[0]||(s[0]=Ge(y=>{var P;return("copyHandle"in n?n.copyHandle:e(ut))((P=e(r))==null?void 0:P.award)},["stop"]))},[a("span",null,o(e(t)("奖品"))+": "+o(("addressFl"in n?n.addressFl:e(_e))((ne=e(r))==null?void 0:ne.award)),1),w(N,{"class-prefix":"iconfont icon-copy text-white/60 ml-1"})])]),a("div",kt,[a("div",null,[(se=e(r))!=null&&se.award?(u(),c("img",{key:0,class:"w-20 h-20",src:e(U)[(oe=e(r))==null?void 0:oe.award].icon,alt:""},null,8,Nt)):(u(),c("div",Pt))]),a("div",It,[a("div",Ct,[a("span",null,o(e(t)("总筹码"))+": ",1),a("span",null,o((le=e(r))==null?void 0:le.total),1)]),a("div",At,[a("span",null,o(e(t)("总下注"))+": ",1),a("span",null,o((re=e(r))==null?void 0:re.pour),1)]),a("div",Ut,[a("span",null,o(e(t)("已下注"))+": ",1),a("span",null,o(e(x)),1)]),a("div",Bt,[a("span",null,o(e(t)("概率"))+": ",1),a("span",Ft,o(("formatNumber"in n?n.formatNumber:e(ye))(e(B),0,2))+"%",1)]),(ue=e(r))!=null&&ue.drawNum?(u(),c("div",Tt,[a("div",null,o(e(t)("幸运数")),1),a("div",Mt,o((ie=e(r))==null?void 0:ie.drawNum),1)])):ge("",!0)])])])]),a("div",$t,o(e(t)("下注记录")),1),a("div",qt,[a("div",Ht,[a("div",null,o(e(t)("排序")),1),a("div",null,o(e(t)("地址")),1),a("div",null,o(e(t)("数量")),1)]),w(A,{"model-value":e(z),onRefresh:e(T)},{default:O(()=>{var y,P;return[((P=(y=e(H))==null?void 0:y.pages[0])==null?void 0:P.list.length)===0?(u(),R(D,{key:0,image:"/empty.png",description:e(t)("暂无下注记录")},null,8,["description"])):(u(),R(ee,{key:1,loading:e(i),finished:!e(f),"loading-text":e(t)("加载中")+"...","finished-text":e(t)("没有更多了"),onLoad:e(k)},{default:O(()=>{var b;return[a("div",Lt,[(u(!0),c(j,null,E((b=e(H))==null?void 0:b.pages,(ce,$e)=>(u(),c(j,{key:$e},[(u(!0),c(j,null,E(ce.list,(K,me)=>(u(),c("div",{key:me,class:Ze(["flex justify-between my-2 py-1 px-3",e(q)(K)])},[a("div",null,o(me+1),1),a("div",null,o(("addressFl"in n?n.addressFl:e(_e))(K.user)),1),a("div",null,o(K.amount),1)],2))),128))],64))),128)),s[7]||(s[7]=a("div",{class:"h-[100px]"},null,-1))])]}),_:1},8,["loading","finished","loading-text","finished-text","onLoad"]))]}),_:1},8,["model-value","onRefresh"])]),a("div",null,[w(Te,{height:e(S),"onUpdate:height":s[5]||(s[5]=y=>Y(S)?S.value=y:null),anchors:L,onHeightChange:Be},{default:O(()=>{var y,P;return[a("div",St,[a("div",Dt,[w(te,{onFocus:s[1]||(s[1]=b=>Ue()),modelValue:e(d),"onUpdate:modelValue":s[2]||(s[2]=b=>Y(d)?d.value=b:null),class:"bg-transparent flex-1",placeholder:e(t)("请输入投入数量")},null,8,["modelValue","placeholder"]),(y=e(r))!=null&&y.award?(u(),c("img",{key:0,class:"w-8 h-8",src:e(l).tokenInfo.icon,alt:""},null,8,Rt)):ge("",!0)]),a("div",null,[a("div",jt,[(u(!0),c(j,null,E(e(Ie),b=>(u(),c("button",{key:b,class:"px-2 py-1 bg-transparent text-white border border-white/20 rounded",onClick:ce=>d.value=Number(e(d))+b}," + "+o(b),9,Wt))),128))])]),a("div",Vt,o(e(t)("账户筹码"))+": "+o(("formatNumber"in n?n.formatNumber:e(ye))(("formatUnit"in n?n.formatUnit:e(we))(e(l).balance))),1),e(Ce)?(u(),c("button",{key:1,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:s[4]||(s[4]=b=>e(Fe)()),disabled:e(Z)||!e(d)||Number(e(d))<=0},[e(Z)?(u(),R(ae,{key:0,type:"spinner",color:"#000"})):(u(),c("span",Ot,o(e(t)("下注")),1))],8,Kt)):(u(),c("button",{key:0,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:s[3]||(s[3]=b=>M.value=!0),disabled:e(X)||!e(d)||Number(e(d))<=0},[e(X)?(u(),R(ae,{key:0,type:"spinner",color:"#000"})):(u(),c("span",Qt,o(e(t)("授权"))+" "+o((P=e(l))==null?void 0:P.tokenInfo.symbol),1))],8,zt))])]}),_:1},8,["height"])]),w(Me,{show:e(M),"onUpdate:show":s[6]||(s[6]=y=>Y(M)?M.value=y:null),address:(de=e(l))==null?void 0:de.tokenInfo.address,amount:e(d)||0,approve:e(Ae)},null,8,["show","address","amount","approve"])])}}}),ra=ft(Yt,[["__scopeId","data-v-c54e7384"]]);export{ra as default};

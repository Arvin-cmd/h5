import{L as re,_ as de,s as ue}from"./CcVF9fBz.js";import{_ as pe,a as fe,s as g,b as me}from"./CmnG0I64.js";import{y as oe,an as ve,ao as _e,v as c,ap as ke,aq as he,ar as be,as as J,at as we,au as xe,av as U,aw as ye,ax as Ie,ay as ge,az as Ce,z as Ae,c as Ue,A as Be,r as $,aA as Pe,e as Q,n as w,q as a,B as e,s as p,O as W,P as Se,aB as B,N as X,aC as Y,w as Te,p as v,F as Fe,C as $e}from"./DJntK_FN.js";import{o as Oe,f as Z,a as ee,p as se}from"./CoYAe5vw.js";import{t as De,b as te,c as He}from"./DEoCiYsP.js";import{u as Ee}from"./BJbCrkEg.js";import{u as ne}from"./Coz_LCV5.js";import{a as Ne}from"./CcZaEtpK.js";import"./DlAUqK2U.js";import"./Cn81O5US.js";const[Le,f]=_e("action-sheet"),Me=ve({},xe,{title:String,round:U,actions:Ie(),closeIcon:ye("cross"),closeable:U,cancelText:String,description:String,closeOnPopstate:U,closeOnClickAction:Boolean,safeAreaInsetBottom:U}),Ve=[...Ce,"round","closeOnPopstate","safeAreaInsetBottom"];var je=oe({name:Le,props:Me,emits:["select","cancel","update:show"],setup(u,{slots:r,emit:i}){const x=o=>i("update:show",o),m=()=>{x(!1),i("cancel")},P=()=>{if(u.title)return c("div",{class:f("header")},[u.title,u.closeable&&c(J,{name:u.closeIcon,class:[f("close"),we],onClick:m},null)])},S=()=>{if(r.cancel||u.cancelText)return[c("div",{class:f("gap")},null),c("button",{type:"button",class:f("cancel"),onClick:m},[r.cancel?r.cancel():u.cancelText])]},k=o=>{if(o.icon)return c(J,{class:f("item-icon"),name:o.icon},null)},y=(o,h)=>o.loading?c(re,{class:f("loading-icon")},null):r.action?r.action({action:o,index:h}):[c("span",{class:f("name")},[o.name]),o.subname&&c("div",{class:f("subname")},[o.subname])],d=(o,h)=>{const{color:T,loading:_,callback:C,disabled:I,className:F}=o,A=()=>{I||_||(C&&C(o),u.closeOnClickAction&&x(!1),ge(()=>i("select",o,h)))};return c("button",{type:"button",style:{color:T},class:[f("item",{loading:_,disabled:I}),F],onClick:A},[k(o),y(o,h)])},t=()=>{if(u.description||r.description){const o=r.description?r.description():u.description;return c("div",{class:f("description")},[o])}};return()=>c(be,ke({class:f(),position:"bottom","onUpdate:show":x},he(u,Ve)),{default:()=>{var o;return[P(),t(),c("div",{class:f("content")},[u.actions.map(d),(o=r.default)==null?void 0:o.call(r)]),S()]}})}});const ze={class:"h-screen w-screen flex flex-col"},Ke={class:"mb-[20vw] flex-1 flex flex-col justify-center px-4"},qe={class:"border-bg rounded-lg bg-white/30 p-3"},Re={class:"relative"},Ge={class:"text-xl font-bold text-center my-4"},Je={class:"mt-6 border border-white/30 rounded-md px-2 py-1 flex items-center"},Qe={class:"text-white/60"},We=["src"],Xe={class:"text-sm mr-4"},Ye=["src"],Ze={class:"text-xs text-white/60 pl-3"},es={class:"text-xs text-white/60 ml-auto pr-2"},ss={class:"flex items-center mt-2"},ts={class:"pr-2 ml-auto"},ns=["src"],os={class:"mt-6"},as=["disabled"],ls={key:1},cs={key:1},is={class:"p-4 divide-y divide-white/20"},rs=["onClick"],ds=["src"],us={class:"text-xs pl-2 flex-1"},ps={class:"text-xs ml-auto pr-2"},Is=oe({__name:"add",setup(u){const{openExplorer:r}=Oe(),{t:i}=Ae(),{address:x}=Ue();Ne({title:"UU竞拍 - 创建您的专属竞拍",ogTitle:"UU竞拍 | 成为庄家，开启您的区块链生意",description:"在UU竞拍平台创建您的专属竞拍活动，成为庄家，自定义奖品和规则，吸引玩家参与。",ogDescription:"想当老板？在UU竞拍平台创建您的专属竞拍，自由设置奖品代币和开奖条件。成为庄家，享受设定规则的乐趣，同时获得参与者的关注。区块链技术保证公平透明，立即开启您的第一场竞拍！"});const m=Ee(),{tokenList:P}=De(),S=["USDT"],k=ne("UB");Be(()=>{x.value&&(k.balanceOf(),k.allowance(m.address.value))});const y=$(!1),d=Pe({award:k.tokenInfo.value.address,total:null}),t=$({...k}),o=P.value.filter(s=>!S.includes(s==null?void 0:s.symbol)).map(s=>ne(s==null?void 0:s.symbol)),h=Q(()=>{var s;return d.total?((s=t.value.tokenInfo)==null?void 0:s.symbol)=="UB"?d.total:1:0}),T=Q(()=>Z(t.value.allowanceMap[m.address.value]||0n,t.value.tokenInfo.decimals)>=h.value),_=$(!1),C=async s=>{d.award=s.tokenInfo.value.address,t.value=s,_.value=!1,x.value&&(s.balance.value||await s.balanceOf(),s.allowanceMap.value[m.address.value]||await s.allowance(m.address.value))},{isPending:I,mutateAsync:F}=te({mutationFn:async s=>{var n,b;if(!s){g("请输入有效金额");return}await((n=t.value)==null?void 0:n.approve(m.address.value,se(s,t.value.tokenInfo.decimals))),await((b=t.value)==null?void 0:b.allowance(m.address.value))}}),{isPending:A,mutate:ae}=te({mutationFn:async()=>{var b;const{award:s,total:n}=d;if(!n)return g("请输入开奖数量");if(n<5)return g(i("开奖筹码数量不能少于")+"5");if(t){if(se(((b=t.value.tokenInfo)==null?void 0:b.symbol)=="UB"?n:1,t.value.tokenInfo.decimals)>t.value.balance)return g("筹码余额不足");await m.userAddAuction(s,BigInt(n)),me(i("创建成功")),t.value.balanceOf(),t.value.allowance(m.address.value),d.total=null}else return g("错误代币");He()}});return(s,n)=>{var E,N,L,M,V,j,z;const b=de,O=pe,D=Se,H=ue,le=fe,ce=je;return v(),w("div",ze,[c(b,{title:e(i)("创建拍卖")},null,8,["title"]),a("div",Ke,[n[7]||(n[7]=a("div",{class:"text-center text-xl mb-4"},"Create Auction",-1)),a("div",qe,[a("div",Re,[a("div",Ge,p(e(i)("创建拍卖")),1),a("div",Je,[a("div",Qe,p(e(i)("开奖筹码")),1),c(O,{modelValue:e(d).total,"onUpdate:modelValue":n[0]||(n[0]=l=>e(d).total=l),class:"bg-transparent text-white flex-1 w-1 text-right h-10",placeholder:"0"},null,8,["modelValue"]),a("img",{class:"w-10 h-10 ml-3",src:e(k).tokenInfo.value.icon,alt:""},null,8,We)]),a("div",{class:"flex items-center my-3 border border-white/30 rounded-md px-2 py-1",onClick:n[2]||(n[2]=l=>_.value=!0)},[a("div",Xe,p(e(i)("奖品选择")),1),a("img",{class:"w-8 h-8",src:e(t).tokenInfo.icon,alt:""},null,8,Ye),a("div",Ze,p((E=e(t).tokenInfo)==null?void 0:E.symbol),1),a("div",es,p(("addressFl"in s?s.addressFl:e(ee))(e(t).tokenInfo.address)),1),c(D,{"class-prefix":"iconfont icon-jump text-white/60",onClick:n[1]||(n[1]=W(l=>e(r)("address",e(t).tokenInfo.address),["stop"]))})]),a("div",ss,[a("div",null,p(e(i)("余额"))+":",1),a("div",ts," x "+p(("formatUnit"in s?s.formatUnit:e(Z))((N=e(t))==null?void 0:N.balance,(M=(L=e(t))==null?void 0:L.tokenInfo)==null?void 0:M.decimals)),1),a("img",{class:"w-5 h-5",src:(V=e(t).tokenInfo)==null?void 0:V.icon,alt:""},null,8,ns)]),a("div",os,[e(T)?(v(),w("button",{key:1,class:B(["btn-bg text-black rounded-full w-full h-10 font-bold",{"opacity-50":e(A)||!e(d).total}]),onClick:n[4]||(n[4]=l=>e(ae)())},[e(A)?(v(),X(H,{key:0,type:"spinner",color:"#000"})):(v(),w("span",cs,p(e(i)("创建")),1))],2)):(v(),w("button",{key:0,class:B(["btn-bg w-full h-10 text-black rounded-full font-bold",{"opacity-50":e(I)||!e(d).total}]),onClick:n[3]||(n[3]=l=>y.value=!0),disabled:e(I)||Number(e(d).total)<=0},[e(I)?(v(),X(H,{key:0,type:"spinner",color:"#000"})):(v(),w("span",ls,p(e(i)("授权"))+" "+p((j=e(t).tokenInfo)==null?void 0:j.symbol),1))],10,as))])])])]),c(le,{show:e(y),"onUpdate:show":n[5]||(n[5]=l=>Y(y)?y.value=l:null),address:(z=e(d))==null?void 0:z.award,amount:e(h),approve:e(F)},null,8,["show","address","amount","approve"]),c(ce,{show:e(_),"onUpdate:show":n[6]||(n[6]=l=>Y(_)?_.value=l:null),title:e(i)("选择奖品代币")},{default:Te(()=>[a("div",is,[(v(!0),w(Fe,null,$e(e(o),l=>{var K,q,R;return v(),w("div",{class:B(["flex items-center py-2",{"text-white/60":l.tokenInfo.value.address!==e(t).tokenInfo.address}]),key:l.tokenInfo.value.address,onClick:ie=>C(l)},[a("img",{class:B(["w-8 h-8",{grayscale:l.tokenInfo.value.address!==e(t).tokenInfo.address}]),src:(K=l.tokenInfo.value)==null?void 0:K.icon,alt:""},null,10,ds),a("div",us,p((q=l.tokenInfo.value)==null?void 0:q.symbol),1),a("div",ps,p(("addressFl"in s?s.addressFl:e(ee))((R=l.tokenInfo.value)==null?void 0:R.address)),1),c(D,{"class-prefix":"iconfont icon-jump",onClick:W(ie=>{var G;return e(r)("address",(G=l.tokenInfo.value)==null?void 0:G.address)},["stop"])},null,8,["onClick"])],10,rs)}),128))])]),_:1},8,["show","title"])])}}});export{Is as default};

import{_ as Le,s as De}from"./Ca0hXmEk.js";import{K as Re,e as Pe,i as ve,L as me,k as He,g as je,s as M,M as Ee,x as p,N as Ve,O as fe,Q as Qe,R as ze,S as he,T as Oe,U as Ye,b as x,V as Ke,u as We,q as Ge,W as Je,X as Xe,r as Ze,J as pe,Y as et,c as v,a as t,z as e,t as s,A as tt,B as at,Z as _e,w as J,E as X,D as V,F as Q,G as Z,y as ge,C as be,o as d}from"./CTDKT58D.js";import{u as nt,Q as st,a as ot,s as lt,b as rt,c as ut}from"./C5NygYla.js";import{c as it,a as dt,_ as ct,s as ye,d as vt}from"./Cmj_vDA7.js";import{o as mt,a as xe,f as we}from"./BWatM3ct.js";import{t as ft,u as ke}from"./D6XtwinG.js";import{u as ht}from"./CCsL0Z-x.js";import{u as pt}from"./Sf1WidT9.js";import{a as _t}from"./C87pYe6_.js";import{u as gt}from"./Dfol5pQH.js";import{_ as bt}from"./DlAUqK2U.js";import"./CSF6aMVe.js";Re(it);const yt={height:me(0),anchors:He(),duration:me(.3),contentDraggable:ve,lockScroll:Boolean,safeAreaInsetBottom:ve},[xt,z]=je("floating-panel");var wt=Pe({name:xt,props:yt,emits:["heightChange","update:height"],setup(m,{emit:S,slots:n}){const N=M(),c=M(),_=Ee(()=>+m.height,i=>S("update:height",i)),P=p(()=>{var i,f;return{min:(i=m.anchors[0])!=null?i:100,max:(f=m.anchors[m.anchors.length-1])!=null?f:Math.round(Ve.value*.6)}}),g=p(()=>m.anchors.length>=2?m.anchors:[P.value.min,P.value.max]),C=M(!1),u=p(()=>({height:fe(P.value.max),transform:`translateY(calc(100% + ${fe(-_.value)}))`,transition:C.value?"none":`transform ${m.duration}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`})),O=i=>{const f=Math.abs(i),{min:o,max:r}=P.value;return f>r?-(r+(f-r)*.2):f<o?-(o-(o-f)*.2):i};let A,w=-1;const T=Qe(),L=i=>{T.start(i),C.value=!0,A=-_.value,w=-1},D=i=>{var f;T.move(i);const o=i.target;if(c.value===o||(f=c.value)!=null&&f.contains(o)){const{scrollTop:B}=c.value;if(w=Math.max(w,B),!m.contentDraggable)return;if(-A<P.value.max)Ke(i,!0);else if(!(B<=0&&T.deltaY.value>0)||w>0)return}const r=T.deltaY.value+A;_.value=-O(r)},R=()=>{w=-1,C.value=!1,_.value=he(g.value,_.value),_.value!==-A&&S("heightChange",{height:_.value})};ze(P,()=>{_.value=he(g.value,_.value)},{immediate:!0}),Oe(N,()=>m.lockScroll||C.value),Ye("touchmove",D,{target:N});const Y=()=>n.header?n.header():x("div",{class:z("header")},[x("div",{class:z("header-bar")},null)]);return()=>{var i;return x("div",{class:[z(),{"van-safe-area-bottom":m.safeAreaInsetBottom}],ref:N,style:u.value,onTouchstartPassive:L,onTouchend:R,onTouchcancel:R},[Y(),x("div",{class:z("content"),ref:c},[(i=n.default)==null?void 0:i.call(n)])])}}});function Ne(m,S){return nt(st,m)}const kt={class:"h-screen flex flex-col font-[dinpro]"},Nt={class:"bg-[#2A2B30] mb-0 rounded-lg overflow-hidden m-3 border-bg"},Pt={class:"relative"},Bt={class:"py-2 px-3 home-bg flex justify-between"},It={class:"px-3 py-2 flex"},Ct=["src"],At={key:1,class:"w-20 h-20 animate-pulse rounded-full bg-white/50"},Tt={class:"pl-3 text-sm text-white/80 flex-1 grid grid-cols-2 content-start"},Mt={class:""},St={class:"text-right"},$t={class:""},Ut={class:"text-right"},qt={class:"text-theme"},Ft={key:0,class:"flex items-center justify-between mt-1 col-span-2"},Lt={class:"font-bold text-lg rounded lucky px-2 flex items-center justify-center"},Dt={class:"text-lg font-bold p-3"},Rt={class:"flex-1 overflow-hidden flex flex-col"},Ht={class:"flex justify-between mb-2 px-3"},jt={class:"flex-1 overflow-auto px-3"},Et={class:"divide-y divide-[#2A2B30] text-white/80"},Vt={class:"px-3 py-2"},Qt={class:"flex items-center border border-white/20 rounded-lg py-1 px-2 mb-3"},zt=["src"],Ot={class:"grid grid-cols-3 gap-2 mb-3"},Yt=["onClick"],Kt={class:"text-xs mb-3"},Wt=["disabled"],Gt={key:1},Jt=["disabled"],Xt={key:1},ee=30n,Zt=Pe({__name:"info",setup(m){const{openExplorer:S}=mt(),{t:n}=We(),{address:$}=Ge();_t({title:"UB竞拍 - 专属竞拍详情",ogTitle:"UB竞拍 | 竞争激烈的实时下注",description:"参与UB去中心化竞拍，查看实时下注情况，计算获胜概率，随时掌握竞拍动态。",ogDescription:"正在进行中的热门竞拍！查看实时下注情况，计算您的中奖概率。在UB竞拍平台，小额投入也有机会赢取ETH和热门代币，透明公正的链上竞争，立即参与！"});const N=Je(),c=ht(),{tokenAddressMap:_}=ft(),{addBetRecord:P}=gt(),g=p(()=>BigInt(N.query.id||0)),C=p(()=>l=>{var b;const a=Number(((b=u.value)==null?void 0:b.drawNum)||0);return a>=l.start&&a<=l.end?"lucky rounded border-none text-black":""}),{data:u,refetch:O}=Ne({queryKey:p(()=>["auctionInfo",N.query.id]),queryFn:async()=>{const l={user:"",award:"",total:0,pour:0,drawNum:0},a=await c.auctionInfo(g.value);return l.user=a[0],l.award=a[1],l.total=Number(a[2]),l.pour=Number(a[3]),a[2]==a[3]&&(l.drawNum=Number(await c.drawNum(g.value))),l}}),A=p(()=>!u.value||!w.value?0:Number(w.value||0)/(Number(u.value.total)||1)*100),{data:w,refetch:T}=Ne({queryKey:p(()=>["pourNum",N.query.id]),queryFn:async()=>c.pourNum(g.value,$.value),enabled:p(()=>!!$.value)}),{data:L,refetch:D,isRefetching:R,isFetching:Y,hasNextPage:i,fetchNextPage:f}=ot({enabled:p(()=>!!$.value),queryKey:p(()=>["getPourList",N.query.id]),refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:l=>l.nextCursor,queryFn:async({pageParam:l=1})=>{const a=await c.getPourList(g.value,BigInt(l),ee),b={list:a[1].map(k=>({...k,amount:Number(k.end-k.start)+1,start:Number(k.start),end:Number(k.end)})),nextCursor:void 0};return(l-1)*Number(ee)+a[1].length<Number(a[0])&&(b.nextCursor=l+1),b}}),o=pt("UB"),r=M(null),B=M(!1),H=[100,300],j=M(H[0]),Be=[1,5,10,50,100,500],{setShowMenu:K}=Xe();Ze(()=>{$.value&&(o.balanceOf(),o.allowance(c.address.value))});const Ie=p(()=>(o.allowanceMap.value[c.address.value]||0n)<pe(String(r.value||0),o.tokenInfo.value.decimals)),{isPending:te,mutateAsync:Ce}=ke({mutationFn:async l=>{await o.approve(c.address.value,pe(String(l),o.tokenInfo.value.decimals)),await o.allowance(c.address.value)}}),Ae=()=>{K(!1),j.value=H[1]},Te=({height:l})=>{K(l==H[0])};et(()=>{K(!0)});const{isPending:W,mutateAsync:Me}=ke({mutationFn:async()=>{var b,U;const l=ge(o.balance.value,o.tokenInfo.value.decimals);if(Number(l)<Number(r.value||0)){ye("余额不足");return}if(Number((b=u.value)==null?void 0:b.total)-Number((U=u.value)==null?void 0:U.pour)<Number(r.value||0)){ye("剩余数量不足");return}const a=vt({message:n("确认中")+"...",duration:0});try{B.value=!1,await c.pourAuction(BigInt(g.value),BigInt(r.value||0)),P(Number(g.value)),r.value=null,O(),D(),T(),o.balanceOf(),o.allowance(c.address.value),a.open({type:"success",message:n("下注成功"),duration:2e3})}catch(k){a.open({type:"error",message:k.shortMessage||n("下注失败"),duration:2e3})}}});return(l,a)=>{var ne,se,oe,le,re,ue,ie,de,ce;const b=Le,U=at,k=rt,Se=ut,$e=lt,Ue=ct,ae=De,qe=wt,Fe=dt;return d(),v("div",kt,[x(b,{title:e(n)("详情")},null,8,["title"]),t("div",Nt,[t("div",Pt,[t("div",Bt,[t("span",null,"# "+s(e(g)),1),t("span",{onClick:a[0]||(a[0]=tt(y=>{var I;return e(S)("address",(I=e(u))==null?void 0:I.award)},["stop"]))},[t("span",null,s(e(n)("奖品"))+": "+s(e(xe)((ne=e(u))==null?void 0:ne.award)),1),x(U,{"class-prefix":"iconfont icon-jump text-white/60 ml-1"})])]),t("div",It,[t("div",null,[(se=e(u))!=null&&se.award?(d(),v("img",{key:0,class:"w-20 h-20",src:e(_)[(oe=e(u))==null?void 0:oe.award].icon,alt:""},null,8,Ct)):(d(),v("div",At))]),t("div",Tt,[t("div",Mt,[t("span",null,s(e(n)("总筹码"))+": ",1),t("span",null,s((le=e(u))==null?void 0:le.total),1)]),t("div",St,[t("span",null,s(e(n)("总下注"))+": ",1),t("span",null,s((re=e(u))==null?void 0:re.pour),1)]),t("div",$t,[t("span",null,s(e(n)("已下注"))+": ",1),t("span",null,s(e(w)),1)]),t("div",Ut,[t("span",null,s(e(n)("概率"))+": ",1),t("span",qt,s(e(we)(e(A),0,2))+"%",1)]),(ue=e(u))!=null&&ue.drawNum?(d(),v("div",Ft,[t("div",null,s(e(n)("幸运数")),1),t("div",Lt,s((ie=e(u))==null?void 0:ie.drawNum),1)])):_e("",!0)])])])]),t("div",Dt,s(e(n)("下注记录")),1),t("div",Rt,[t("div",Ht,[t("div",null,s(e(n)("排序")),1),t("div",null,s(e(n)("地址")),1),t("div",null,s(e(n)("数量")),1)]),t("div",jt,[x($e,{"model-value":e(R),onRefresh:e(D)},{default:J(()=>{var y,I;return[((I=(y=e(L))==null?void 0:y.pages[0])==null?void 0:I.list.length)===0?(d(),V(k,{key:0,image:"/empty.png",description:e(n)("暂无下注记录")},null,8,["description"])):(d(),V(Se,{key:1,loading:e(Y),finished:!e(i),"loading-text":e(n)("加载中")+"...","finished-text":e(n)("没有更多了"),onLoad:e(f)},{default:J(()=>{var q;return[t("div",Et,[(d(!0),v(Q,null,Z((q=e(L))==null?void 0:q.pages,(E,F)=>(d(),v(Q,{key:F},[(d(!0),v(Q,null,Z(E.list,(h,G)=>(d(),v("div",{key:G,class:be(["flex justify-between my-2 py-1 px-3",e(C)(h)])},[t("div",null,s(F*Number(ee)+G+1),1),t("div",null,s(e(xe)(h.user)),1),t("div",null,s(h.amount),1)],2))),128))],64))),128))])]}),_:1},8,["loading","finished","loading-text","finished-text","onLoad"]))]}),_:1},8,["model-value","onRefresh"]),a[7]||(a[7]=t("div",{class:"h-[100px]"},null,-1))])]),t("div",null,[x(qe,{height:e(j),"onUpdate:height":a[5]||(a[5]=y=>X(j)?j.value=y:null),anchors:H,onHeightChange:Te,class:"!z-10"},{default:J(()=>{var y,I,q,E,F;return[t("div",Vt,[t("div",Qt,[x(Ue,{onFocus:a[1]||(a[1]=h=>Ae()),modelValue:e(r),"onUpdate:modelValue":a[2]||(a[2]=h=>X(r)?r.value=h:null),class:"bg-transparent flex-1",placeholder:e(n)("请输入投入数量")},null,8,["modelValue","placeholder"]),(y=e(u))!=null&&y.award?(d(),v("img",{key:0,class:"w-8 h-8",src:e(o).tokenInfo.value.icon,alt:""},null,8,zt)):_e("",!0)]),t("div",null,[t("div",Ot,[(d(),v(Q,null,Z(Be,h=>t("button",{key:h,class:"px-2 py-1 bg-transparent text-white border border-white/20 rounded",onClick:G=>r.value=Number(e(r))+h},"+ "+s(h),9,Yt)),64))])]),t("div",Kt,s(e(n)("账户筹码"))+": "+s(e(we)(e(ge)(e(o).balance.value,e(o).tokenInfo.value.decimals))),1),e(Ie)?(d(),v("button",{key:0,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:a[3]||(a[3]=h=>B.value=!0),disabled:e(te)||Number(e(r)||0)<=0},[e(te)?(d(),V(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Gt,s(e(n)("授权"))+" "+s((q=(I=e(o))==null?void 0:I.tokenInfo.value)==null?void 0:q.symbol),1))],8,Wt)):(d(),v("button",{key:1,class:be(["btn-bg w-full h-9 bg-white text-black rounded-full font-bold",{"opacity-50":e(W)||Number(e(r)||0)<=0||!!((E=e(u))!=null&&E.drawNum)}]),onClick:a[4]||(a[4]=h=>e(Me)()),disabled:e(W)||Number(e(r)||0)<=0||!!((F=e(u))!=null&&F.drawNum)},[e(W)?(d(),V(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Xt,s(e(n)("下注")),1))],10,Jt))])]}),_:1},8,["height"])]),x(Fe,{show:e(B),"onUpdate:show":a[6]||(a[6]=y=>X(B)?B.value=y:null),address:(ce=(de=e(o))==null?void 0:de.tokenInfo.value)==null?void 0:ce.address,amount:e(r)||0,approve:e(Ce)},null,8,["show","address","amount","approve"])])}}}),va=bt(Zt,[["__scopeId","data-v-282f1655"]]);export{va as default};

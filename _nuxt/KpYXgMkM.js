import{L as ee,_ as te,s as ne}from"./oLmhSPqQ.js";import{_ as se,a as oe}from"./BVk2C0Ud.js";import{v as Q,ai as ae,aj as le,q as i,ak as ce,al as ie,am as re,an as N,ao as de,ap as ue,aq as U,ar as pe,as as fe,at as me,au as ve,x as ke,r as B,av as _e,c as L,m as _,n as l,y as e,p,J as V,K as be,aw as A,I as K,ax as E,w as he,o as v,F as we,z as ye}from"./RL1ig8FZ.js";import{f as j,a as q,c as z,s as I,p as J}from"./DhXQRDnN.js";import{t as xe,b as R,c as Ie}from"./D8S4GKic.js";import{u as ge}from"./NnSjaIu3.js";import{u as G}from"./FKcu2zTh.js";import{a as Ce}from"./eWe1y3MY.js";import"./DlAUqK2U.js";import"./DBGHBmPk.js";const[Ue,f]=le("action-sheet"),Ae=ae({},ue,{title:String,round:U,actions:fe(),closeIcon:pe("cross"),closeable:U,cancelText:String,description:String,closeOnPopstate:U,closeOnClickAction:Boolean,safeAreaInsetBottom:U}),Pe=[...ve,"round","closeOnPopstate","safeAreaInsetBottom"];var He=Q({name:Ue,props:Ae,emits:["select","cancel","update:show"],setup(u,{slots:t,emit:d}){const w=a=>d("update:show",a),g=()=>{w(!1),d("cancel")},k=()=>{if(u.title)return i("div",{class:f("header")},[u.title,u.closeable&&i(N,{name:u.closeIcon,class:[f("close"),de],onClick:g},null)])},b=()=>{if(t.cancel||u.cancelText)return[i("div",{class:f("gap")},null),i("button",{type:"button",class:f("cancel"),onClick:g},[t.cancel?t.cancel():u.cancelText])]},r=a=>{if(a.icon)return i(N,{class:f("item-icon"),name:a.icon},null)},s=(a,m)=>a.loading?i(ee,{class:f("loading-icon")},null):t.action?t.action({action:a,index:m}):[i("span",{class:f("name")},[a.name]),a.subname&&i("div",{class:f("subname")},[a.subname])],P=(a,m)=>{const{color:S,loading:h,callback:C,disabled:y,className:T}=a,n=()=>{y||h||(C&&C(a),u.closeOnClickAction&&w(!1),me(()=>d("select",a,m)))};return i("button",{type:"button",style:{color:S},class:[f("item",{loading:h,disabled:y}),T],onClick:n},[r(a),s(a,m)])},H=()=>{if(u.description||t.description){const a=t.description?t.description():u.description;return i("div",{class:f("description")},[a])}};return()=>i(re,ce({class:f(),position:"bottom","onUpdate:show":w},ie(u,Pe)),{default:()=>{var a;return[k(),H(),i("div",{class:f("content")},[u.actions.map(P),(a=t.default)==null?void 0:a.call(t)]),b()]}})}});const Se={class:"h-screen w-screen flex flex-col"},Te={class:"mb-[20vw] flex-1 flex flex-col justify-center px-4"},Be={class:"border-bg rounded-lg bg-white/30 p-3"},Fe={class:"relative"},$e={class:"text-xl font-bold text-center my-4"},De={class:"mt-6 border border-white/30 rounded-md px-2 py-1 flex items-center"},Me={class:"text-white/60"},Oe=["src"],Ne={class:"text-sm mr-4"},Le=["src"],Ve={class:"text-xs text-white/60 pl-3"},Ke={class:"text-xs text-white/60 ml-auto pr-2"},Ee={class:"flex items-center mt-2"},je={class:"pr-2 ml-auto"},qe=["src"],ze={class:"mt-6"},Je=["disabled"],Re={key:1},Ge={key:1},Qe={class:"p-4 divide-y divide-white/20"},We=["onClick"],Xe=["src"],Ye={class:"text-xs pl-2 flex-1"},Ze={class:"text-xs ml-auto pr-2"},dt=Q({__name:"add",setup(u){const{t}=ke();Ce({title:"UU"+t("竞拍")+" - "+t("创建您的专属竞拍"),ogTitle:"UU"+t("竞拍")+" | "+t("成为庄家")+"，"+t("开启您的区块链生意"),description:t("在")+"UU"+t("竞拍平台创建您的专属竞拍活动")+"，"+t("成为庄家")+"，"+t("自定义奖品和规则")+"，"+t("吸引玩家参与")+"。",ogDescription:t("想当老板")+"？"+t("在")+"UU"+t("竞拍平台创建您的专属竞拍")+"，"+t("自由设置奖品代币和开奖条件")+"。"+t("成为庄家")+"，"+t("享受设定规则的乐趣")+"，"+t("同时获得参与者的关注")+"。"+t("区块链技术保证公平透明")+"，"+t("立即开启您的第一场竞拍")+"！"});const d=ge(),{tokenList:w}=xe(),g=["USDT"],k=G("UB");k.balanceOf(),k.allowance(d.address.value);const b=B(!1),r=_e({award:k.tokenInfo.value.address,total:null}),s=B({...k}),P=w.value.filter(n=>!g.includes(n.symbol)).map(n=>G(n.symbol)),H=L(()=>r.total?s.value.tokenInfo.symbol=="UB"?r.total:1:0),a=L(()=>j(s.value.allowanceMap[d.address.value]||0n,s.value.tokenInfo.decimals)>=Number(r.total)),m=B(!1),S=async n=>{r.award=n.tokenInfo.value.address,s.value=n,m.value=!1,n.balance.value||await n.balanceOf(),n.allowanceMap.value[d.address.value]||await n.allowance(d.address.value)},{isPending:h,mutateAsync:C}=R({mutationFn:async n=>{var o,x;if(!n){I("请输入有效金额");return}await((o=s.value)==null?void 0:o.approve(d.address.value,J(n,s.value.tokenInfo.decimals))),await((x=s.value)==null?void 0:x.allowance(d.address.value)),console.log("token.value.allowanceMap[auctionHook.address.value]",s.value.allowanceMap[d.address.value])}}),{isPending:y,mutate:T}=R({mutationFn:async()=>{const{award:n,total:o}=r;if(!o)return I("请输入开奖数量");if(o<2)return I(t("开奖筹码数量不能少于")+"2");if(s){if(J(s.value.tokenInfo.symbol=="UB"?o:1,s.value.tokenInfo.decimals)>s.value.balance)return I("筹码余额不足");await d.userAddAuction(n,BigInt(o)),s.value.balanceOf(),s.value.allowance(d.address.value),r.total=null}else return I("错误代币");Ie()}});return(n,o)=>{var D,M,O;const x=te,W=se,F=be,$=ne,X=oe,Y=He;return v(),_("div",Se,[i(x,{title:e(t)("创建拍卖")},null,8,["title"]),l("div",Te,[o[7]||(o[7]=l("div",{class:"text-center text-xl mb-4"},"Create Auction",-1)),l("div",Be,[l("div",Fe,[l("div",$e,p(e(t)("创建拍卖")),1),l("div",De,[l("div",Me,p(e(t)("开奖筹码")),1),i(W,{modelValue:e(r).total,"onUpdate:modelValue":o[0]||(o[0]=c=>e(r).total=c),class:"bg-transparent text-white flex-1 text-right h-10",placeholder:"0"},null,8,["modelValue"]),l("img",{class:"w-10 h-10 ml-3",src:e(k).tokenInfo.value.icon,alt:""},null,8,Oe)]),l("div",{class:"flex items-center my-3 border border-white/30 rounded-md px-2 py-1",onClick:o[2]||(o[2]=c=>m.value=!0)},[l("div",Ne,p(e(t)("奖品选择")),1),l("img",{class:"w-8 h-8",src:e(s).tokenInfo.icon,alt:""},null,8,Le),l("div",Ve,p(e(s).tokenInfo.symbol),1),l("div",Ke,p(("addressFl"in n?n.addressFl:e(q))(e(s).tokenInfo.address)),1),i(F,{"class-prefix":"iconfont icon-copy text-white/60",onClick:o[1]||(o[1]=V(c=>("copyHandle"in n?n.copyHandle:e(z))(e(s).tokenInfo.address),["stop"]))})]),l("div",Ee,[l("div",null,p(e(t)("余额"))+":",1),l("div",je," x "+p(("formatUnit"in n?n.formatUnit:e(j))((D=e(s))==null?void 0:D.balance,(M=e(s))==null?void 0:M.tokenInfo.decimals)),1),l("img",{class:"w-5 h-5",src:e(s).tokenInfo.icon,alt:""},null,8,qe)]),l("div",ze,[e(a)?(v(),_("button",{key:1,class:A(["btn-bg text-black rounded-full w-full h-10 font-bold",{"opacity-50":e(y)||!e(r).total}]),onClick:o[4]||(o[4]=c=>e(T)())},[e(y)?(v(),K($,{key:0,type:"spinner",color:"#000"})):(v(),_("span",Ge,p(e(t)("创建")),1))],2)):(v(),_("button",{key:0,class:A(["btn-bg w-full h-10 text-black rounded-full font-bold",{"opacity-50":e(h)||!e(r).total}]),onClick:o[3]||(o[3]=c=>b.value=!0),disabled:e(h)||Number(e(r).total)<=0},[e(h)?(v(),K($,{key:0,type:"spinner",color:"#000"})):(v(),_("span",Re,p(e(t)("授权"))+" "+p(e(s).tokenInfo.symbol),1))],10,Je))])])])]),i(X,{show:e(b),"onUpdate:show":o[5]||(o[5]=c=>E(b)?b.value=c:null),address:(O=e(r))==null?void 0:O.award,amount:e(H),approve:e(C)},null,8,["show","address","amount","approve"]),i(Y,{show:e(m),"onUpdate:show":o[6]||(o[6]=c=>E(m)?m.value=c:null),title:e(t)("选择奖品代币")},{default:he(()=>[l("div",Qe,[(v(!0),_(we,null,ye(e(P),c=>(v(),_("div",{class:A(["flex items-center py-2",{"text-white/60":c.tokenInfo.value.address!==e(s).tokenInfo.address}]),key:c.tokenInfo.value.address,onClick:Z=>S(c)},[l("img",{class:A(["w-8 h-8",{grayscale:c.tokenInfo.value.address!==e(s).tokenInfo.address}]),src:c.tokenInfo.value.icon,alt:""},null,10,Xe),l("div",Ye,p(c.tokenInfo.value.symbol),1),l("div",Ze,p(("addressFl"in n?n.addressFl:e(q))(c.tokenInfo.value.address)),1),i(F,{"class-prefix":"iconfont icon-copy",onClick:V(Z=>("copyHandle"in n?n.copyHandle:e(z))(c.tokenInfo.value.address),["stop"])},null,8,["onClick"])],10,We))),128))])]),_:1},8,["show","title"])])}}});export{dt as default};

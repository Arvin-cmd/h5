import{L as re,_ as de,s as ue}from"./DttBTQhN.js";import{_ as fe,a as pe,s as I,b as me}from"./D-_9ru_Q.js";import{y as ne,an as ve,ao as _e,v as i,ap as he,aq as ke,ar as we,as as J,at as be,au as xe,av as U,aw as ye,ax as ge,ay as Ie,az as Ce,z as Ae,c as Ue,A as Be,r as D,aA as Pe,e as Q,n as b,q as a,B as e,s as f,O as W,P as Se,aB as B,N as X,aC as Y,w as Te,p as v,F as Fe,C as $e}from"./riPymW3M.js";import{o as De,f as Z,a as ee,p as se}from"./XXTYGTbl.js";import{t as Oe,b as te,c as He,d as Ee}from"./CRZOKbAF.js";import{u as Ne}from"./7b4zzCzZ.js";import{u as oe}from"./MNP8_Z6Z.js";import{a as Le}from"./CKKhEfdK.js";import"./DlAUqK2U.js";import"./DJz_k-9G.js";const[Me,p]=_e("action-sheet"),Ve=ve({},xe,{title:String,round:U,actions:ge(),closeIcon:ye("cross"),closeable:U,cancelText:String,description:String,closeOnPopstate:U,closeOnClickAction:Boolean,safeAreaInsetBottom:U}),je=[...Ce,"round","closeOnPopstate","safeAreaInsetBottom"];var ze=ne({name:Me,props:Ve,emits:["select","cancel","update:show"],setup(u,{slots:r,emit:l}){const x=n=>l("update:show",n),m=()=>{x(!1),l("cancel")},P=()=>{if(u.title)return i("div",{class:p("header")},[u.title,u.closeable&&i(J,{name:u.closeIcon,class:[p("close"),be],onClick:m},null)])},S=()=>{if(r.cancel||u.cancelText)return[i("div",{class:p("gap")},null),i("button",{type:"button",class:p("cancel"),onClick:m},[r.cancel?r.cancel():u.cancelText])]},h=n=>{if(n.icon)return i(J,{class:p("item-icon"),name:n.icon},null)},y=(n,k)=>n.loading?i(re,{class:p("loading-icon")},null):r.action?r.action({action:n,index:k}):[i("span",{class:p("name")},[n.name]),n.subname&&i("div",{class:p("subname")},[n.subname])],d=(n,k)=>{const{color:T,loading:_,callback:C,disabled:g,className:F}=n,A=()=>{g||_||(C&&C(n),u.closeOnClickAction&&x(!1),Ie(()=>l("select",n,k)))};return i("button",{type:"button",style:{color:T},class:[p("item",{loading:_,disabled:g}),F],onClick:A},[h(n),y(n,k)])},t=()=>{if(u.description||r.description){const n=r.description?r.description():u.description;return i("div",{class:p("description")},[n])}};return()=>i(we,he({class:p(),position:"bottom","onUpdate:show":x},ke(u,je)),{default:()=>{var n;return[P(),t(),i("div",{class:p("content")},[u.actions.map(d),(n=r.default)==null?void 0:n.call(r)]),S()]}})}});const Ke={class:"h-screen w-screen flex flex-col"},qe={class:"mb-[20vw] flex-1 flex flex-col justify-center px-4"},Re={class:"border-bg rounded-lg bg-white/30 p-3"},Ge={class:"relative"},Je={class:"text-xl font-bold text-center my-4"},Qe={class:"mt-6 border border-white/30 rounded-md px-2 py-1 flex items-center"},We={class:"text-white/60"},Xe=["src"],Ye={class:"text-sm mr-4"},Ze=["src"],es={class:"text-xs text-white/60 pl-3"},ss={class:"text-xs text-white/60 ml-auto pr-2"},ts={class:"flex items-center mt-2"},os={class:"pr-2 ml-auto"},ns=["src"],as={class:"mt-6"},ls=["disabled"],cs={key:1},is={key:1},rs={class:"p-4 divide-y divide-white/20"},ds=["onClick"],us=["src"],fs={class:"text-xs pl-2 flex-1"},ps={class:"text-xs ml-auto pr-2"},Is=ne({__name:"add",setup(u){const{openExplorer:r}=De(),{t:l}=Ae(),{address:x}=Ue();Le({title:"UU竞拍 - 创建您的专属竞拍",ogTitle:"UU竞拍 | 成为庄家，开启您的区块链生意",description:"在UU竞拍平台创建您的专属竞拍活动，成为庄家，自定义奖品和规则，吸引玩家参与。",ogDescription:"想当老板？在UU竞拍平台创建您的专属竞拍，自由设置奖品代币和开奖条件。成为庄家，享受设定规则的乐趣，同时获得参与者的关注。区块链技术保证公平透明，立即开启您的第一场竞拍！"});const m=Ne(),{tokenList:P}=Oe(),S=["USDT"],h=oe("UB");Be(()=>{x.value&&(h.balanceOf(),h.allowance(m.address.value))});const y=D(!1),d=Pe({award:h.tokenInfo.value.address,total:null}),t=D({...h}),n=P.value.filter(s=>!S.includes(s==null?void 0:s.symbol)).map(s=>oe(s==null?void 0:s.symbol)),k=Q(()=>{var s;return d.total?((s=t.value.tokenInfo)==null?void 0:s.symbol)=="UB"?d.total:1:0}),T=Q(()=>Z(t.value.allowanceMap[m.address.value]||0n,t.value.tokenInfo.decimals)>=k.value),_=D(!1),C=async s=>{d.award=s.tokenInfo.value.address,t.value=s,_.value=!1,x.value&&(s.balance.value||await s.balanceOf(),s.allowanceMap.value[m.address.value]||await s.allowance(m.address.value))},{isPending:g,mutateAsync:F}=te({mutationFn:async s=>{var o,w;if(!s){I("请输入有效金额");return}await((o=t.value)==null?void 0:o.approve(m.address.value,se(s,t.value.tokenInfo.decimals))),await((w=t.value)==null?void 0:w.allowance(m.address.value))}}),{isPending:A,mutate:ae}=te({mutationFn:async()=>{var w;const{award:s,total:o}=d;if(!o)return I(l("请输入开奖数量"));if(o<5)return I(l("开奖筹码数量不能少于")+"5");if(t){if(se(((w=t.value.tokenInfo)==null?void 0:w.symbol)=="UB"?o:1,t.value.tokenInfo.decimals)>t.value.balance)return I(l("筹码余额不足"));try{await He({title:l("温馨提示"),messageAlign:"left",message:l("一旦创建成功")+"，"+l("就不能取消了")+"，"+l("必须等到开奖后才能取回未开奖的筹码")+"。"}),await m.userAddAuction(s,BigInt(o)),me(l("创建成功")),t.value.balanceOf(),t.value.allowance(m.address.value),d.total=null}catch{I(l("创建失败"))}}else return I("错误代币");Ee()}});return(s,o)=>{var E,N,L,M,V,j,z;const w=de,O=fe,$=Se,H=ue,le=pe,ce=ze;return v(),b("div",Ke,[i(w,{title:e(l)("创建拍卖")},null,8,["title"]),a("div",qe,[o[7]||(o[7]=a("div",{class:"text-center text-xl mb-4"},"Create Auction",-1)),a("div",Re,[a("div",Ge,[a("div",Je,f(e(l)("创建拍卖")),1),a("div",Qe,[a("div",We,f(e(l)("开奖筹码")),1),i(O,{modelValue:e(d).total,"onUpdate:modelValue":o[0]||(o[0]=c=>e(d).total=c),class:"bg-transparent text-white flex-1 w-1 text-right h-10",placeholder:"0"},null,8,["modelValue"]),a("img",{class:"w-10 h-10 ml-3",src:e(h).tokenInfo.value.icon,alt:""},null,8,Xe)]),a("div",{class:"flex items-center my-3 border border-white/30 rounded-md px-2 py-1",onClick:o[2]||(o[2]=c=>_.value=!0)},[a("div",Ye,f(e(l)("奖品选择")),1),a("img",{class:"w-8 h-8",src:e(t).tokenInfo.icon,alt:""},null,8,Ze),a("div",es,f((E=e(t).tokenInfo)==null?void 0:E.symbol),1),a("div",ss,f(("addressFl"in s?s.addressFl:e(ee))(e(t).tokenInfo.address)),1),i($,{"class-prefix":"iconfont icon-jump text-white/60",onClick:o[1]||(o[1]=W(c=>e(r)("address",e(t).tokenInfo.address),["stop"]))})]),a("div",ts,[a("div",null,f(e(l)("余额"))+":",1),a("div",os," x "+f(("formatUnit"in s?s.formatUnit:e(Z))((N=e(t))==null?void 0:N.balance,(M=(L=e(t))==null?void 0:L.tokenInfo)==null?void 0:M.decimals)),1),a("img",{class:"w-5 h-5",src:(V=e(t).tokenInfo)==null?void 0:V.icon,alt:""},null,8,ns)]),a("div",as,[e(T)?(v(),b("button",{key:1,class:B(["btn-bg text-black rounded-full w-full h-10 font-bold",{"opacity-50":e(A)||!e(d).total}]),onClick:o[4]||(o[4]=c=>e(ae)())},[e(A)?(v(),X(H,{key:0,type:"spinner",color:"#000"})):(v(),b("span",is,f(e(l)("创建")),1))],2)):(v(),b("button",{key:0,class:B(["btn-bg w-full h-10 text-black rounded-full font-bold",{"opacity-50":e(g)||!e(d).total}]),onClick:o[3]||(o[3]=c=>y.value=!0),disabled:e(g)||Number(e(d).total)<=0},[e(g)?(v(),X(H,{key:0,type:"spinner",color:"#000"})):(v(),b("span",cs,f(e(l)("授权"))+" "+f((j=e(t).tokenInfo)==null?void 0:j.symbol),1))],10,ls))])])])]),i(le,{show:e(y),"onUpdate:show":o[5]||(o[5]=c=>Y(y)?y.value=c:null),address:(z=e(d))==null?void 0:z.award,amount:e(k),approve:e(F)},null,8,["show","address","amount","approve"]),i(ce,{show:e(_),"onUpdate:show":o[6]||(o[6]=c=>Y(_)?_.value=c:null),title:e(l)("选择奖品代币")},{default:Te(()=>[a("div",rs,[(v(!0),b(Fe,null,$e(e(n),c=>{var K,q,R;return v(),b("div",{class:B(["flex items-center py-2",{"text-white/60":c.tokenInfo.value.address!==e(t).tokenInfo.address}]),key:c.tokenInfo.value.address,onClick:ie=>C(c)},[a("img",{class:B(["w-8 h-8",{grayscale:c.tokenInfo.value.address!==e(t).tokenInfo.address}]),src:(K=c.tokenInfo.value)==null?void 0:K.icon,alt:""},null,10,us),a("div",fs,f((q=c.tokenInfo.value)==null?void 0:q.symbol),1),a("div",ps,f(("addressFl"in s?s.addressFl:e(ee))((R=c.tokenInfo.value)==null?void 0:R.address)),1),i($,{"class-prefix":"iconfont icon-jump",onClick:W(ie=>{var G;return e(r)("address",(G=c.tokenInfo.value)==null?void 0:G.address)},["stop"])},null,8,["onClick"])],10,ds)}),128))])]),_:1},8,["show","title"])])}}});export{Is as default};

import{_ as Le,s as Se}from"./DyEelTsz.js";import{bJ as Re,y as Ne,av as ce,b8 as ve,ax as De,ao as He,r as B,bK as je,e as p,be as Ee,bL as me,ba as Oe,bc as Qe,bM as fe,bN as Ve,bk as ze,v as w,bp as Ke,z as Ye,c as Je,bO as We,bP as Ge,A as Xe,bQ as Ze,n as v,q as t,B as e,s as o,O as et,P as tt,bR as he,w as G,aC as X,N as O,F as Q,C as Z,aB as pe,p as d}from"./DHezVORj.js";import{c as at,Q as nt,u as st,s as ot,a as lt,b as rt}from"./CbxqNEfx.js";import{d as ut,a as it,_ as dt,s as be,c as ct}from"./Dc80nEPY.js";import{o as vt,p as ge,a as _e,b as ye,f as we}from"./CrQjWAXG.js";import{t as mt,b as xe}from"./CAzsE_Ya.js";import{u as ft}from"./DFZFRi1s.js";import{u as ht}from"./DUcmS3SW.js";import{a as pt}from"./CXcG1I9f.js";import{u as bt}from"./DGh0OQgW.js";import{_ as gt}from"./DlAUqK2U.js";import"./BWpKyB0o.js";Re(ut);const _t={height:ve(0),anchors:De(),duration:ve(.3),contentDraggable:ce,lockScroll:Boolean,safeAreaInsetBottom:ce},[yt,V]=He("floating-panel");var wt=Ne({name:yt,props:_t,emits:["heightChange","update:height"],setup(m,{emit:T,slots:s}){const k=B(),c=B(),b=je(()=>+m.height,i=>T("update:height",i)),N=p(()=>{var i,f;return{min:(i=m.anchors[0])!=null?i:100,max:(f=m.anchors[m.anchors.length-1])!=null?f:Math.round(Ee.value*.6)}}),g=p(()=>m.anchors.length>=2?m.anchors:[N.value.min,N.value.max]),A=B(!1),u=p(()=>({height:me(N.value.max),transform:`translateY(calc(100% + ${me(-b.value)}))`,transition:A.value?"none":`transform ${m.duration}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`})),z=i=>{const f=Math.abs(i),{min:l,max:r}=N.value;return f>r?-(r+(f-r)*.2):f<l?-(l-(l-f)*.2):i};let U,x=-1;const F=Oe(),L=i=>{F.start(i),A.value=!0,U=-b.value,x=-1},S=i=>{var f;F.move(i);const l=i.target;if(c.value===l||(f=c.value)!=null&&f.contains(l)){const{scrollTop:P}=c.value;if(x=Math.max(x,P),!m.contentDraggable)return;if(-U<N.value.max)Ke(i,!0);else if(!(P<=0&&F.deltaY.value>0)||x>0)return}const r=F.deltaY.value+U;b.value=-z(r)},R=()=>{x=-1,A.value=!1,b.value=fe(g.value,b.value),b.value!==-U&&T("heightChange",{height:b.value})};Qe(N,()=>{b.value=fe(g.value,b.value)},{immediate:!0}),Ve(k,()=>m.lockScroll||A.value),ze("touchmove",S,{target:k});const K=()=>s.header?s.header():w("div",{class:V("header")},[w("div",{class:V("header-bar")},null)]);return()=>{var i;return w("div",{class:[V(),{"van-safe-area-bottom":m.safeAreaInsetBottom}],ref:k,style:u.value,onTouchstartPassive:L,onTouchend:R,onTouchcancel:R},[K(),w("div",{class:V("content"),ref:c},[(i=s.default)==null?void 0:i.call(s)])])}}});function ke(m,T){return at(nt,m)}const xt={class:"h-screen flex flex-col font-[dinpro]"},kt={class:"bg-[#2A2B30] mb-0 rounded-lg overflow-hidden m-3 border-bg"},Nt={class:"relative"},Pt={class:"py-2 px-3 home-bg flex justify-between"},Ct={class:"px-3 py-2 flex"},It=["src"],Bt={key:1,class:"w-20 h-20 animate-pulse rounded-full bg-white/50"},At={class:"pl-3 text-sm text-white/80 flex-1 grid grid-cols-2 content-start"},Ut={class:""},Ft={class:"text-right"},Tt={class:""},Mt={class:"text-right"},$t={class:"text-theme"},qt={key:0,class:"flex items-center justify-between mt-1 col-span-2"},Lt={class:"font-bold text-lg rounded lucky px-2 flex items-center justify-center"},St={class:"text-lg font-bold p-3"},Rt={class:"flex-1 overflow-hidden flex flex-col"},Dt={class:"flex justify-between mb-2 px-3"},Ht={class:"flex-1 overflow-auto px-3"},jt={class:"divide-y divide-[#2A2B30] text-white/80"},Et={class:"px-3 py-2"},Ot={class:"flex items-center border border-white/20 rounded-lg py-1 px-2 mb-3"},Qt=["src"],Vt={class:"grid grid-cols-3 gap-2 mb-3"},zt=["onClick"],Kt={class:"text-xs mb-3"},Yt=["disabled"],Jt={key:1},Wt=["disabled"],Gt={key:1},ee=30n,Xt=Ne({__name:"info",setup(m){const{openExplorer:T}=vt(),{t:s}=Ye(),{address:M}=Je();pt({title:"UU竞拍 - 专属竞拍详情",ogTitle:"UU竞拍 | 竞争激烈的实时下注",description:"参与UU去中心化竞拍，查看实时下注情况，计算获胜概率，随时掌握竞拍动态。",ogDescription:"正在进行中的热门竞拍！查看实时下注情况，计算您的中奖概率。在UU竞拍平台，小额投入也有机会赢取ETH和热门代币，透明公正的链上竞争，立即参与！"});const k=We(),c=ft(),{tokenAddressMap:b}=mt(),{addBetRecord:N}=bt(),g=p(()=>BigInt(k.query.id||0)),A=p(()=>a=>{var _;const n=Number(((_=u.value)==null?void 0:_.drawNum)||0);return n>=a.start&&n<=a.end?"lucky rounded border-none text-black":""}),{data:u,refetch:z}=ke({queryKey:p(()=>["auctionInfo",k.query.id]),queryFn:async()=>{const a={user:"",award:"",total:0,pour:0,drawNum:0},n=await c.auctionInfo(g.value);return a.user=n[0],a.award=n[1],a.total=Number(n[2]),a.pour=Number(n[3]),n[2]==n[3]&&(a.drawNum=Number(await c.drawNum(g.value))),a}}),U=p(()=>!u.value||!x.value?0:Number(x.value||0)/(Number(u.value.total)||1)*100),{data:x,refetch:F}=ke({queryKey:p(()=>["pourNum",k.query.id]),queryFn:async()=>c.pourNum(g.value,M.value),enabled:p(()=>!!M.value)}),{data:L,refetch:S,isRefetching:R,isFetching:K,hasNextPage:i,fetchNextPage:f}=st({enabled:p(()=>!!M.value),queryKey:p(()=>["getPourList",k.query.id]),refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:a=>a.nextCursor,queryFn:async({pageParam:a=1})=>{const n=await c.getPourList(g.value,BigInt(a),ee),_={list:n[1].map(I=>({...I,amount:Number(I.end-I.start)+1,start:Number(I.start),end:Number(I.end)})),nextCursor:void 0};return(a-1)*Number(ee)+n[1].length<Number(n[0])&&(_.nextCursor=a+1),_}}),l=B(ht("UB")),r=B(null),P=B(!1),D=[100,300],H=B(D[0]),Pe=[1,5,10,50,100,500],{setShowMenu:Y}=Ge();Xe(()=>{M.value&&(l.value.balanceOf(),l.value.allowance(c.address.value))});const Ce=p(()=>l.value.allowanceMap[c.address.value]||0n>=ge(r.value||0,l.value.tokenInfo.decimals)),{isPending:te,mutateAsync:Ie}=xe({mutationFn:async a=>{await l.value.approve(c.address.value,ge(a,l.value.tokenInfo.decimals)),await l.value.allowance(c.address.value)}}),Be=()=>{Y(!1),H.value=D[1]},Ae=({height:a})=>{Y(a==D[0])};Ze(()=>{Y(!0)});const{isPending:J,mutateAsync:Ue}=xe({mutationFn:async()=>{var n,_;if(we(l.value.balance,l.value.tokenInfo.decimals)<Number(r.value||0)){be("余额不足");return}if(Number((n=u.value)==null?void 0:n.total)-Number((_=u.value)==null?void 0:_.pour)<Number(r.value||0)){be("剩余数量不足");return}const a=ct({message:s("确认中")+"...",duration:0});try{P.value=!1,await c.pourAuction(BigInt(g.value),BigInt(r.value||0)),N(Number(g.value)),r.value=null,z(),S(),F(),l.value.balanceOf(),l.value.allowance(c.address.value),a.open({type:"success",message:s("下注成功"),duration:2e3})}catch(j){a.open({type:"error",message:j.shortMessage||s("下注失败"),duration:2e3})}}});return(a,n)=>{var ne,se,oe,le,re,ue,ie,de;const _=Le,j=tt,I=lt,Fe=rt,Te=ot,Me=dt,ae=Se,$e=wt,qe=it;return d(),v("div",xt,[w(_,{title:e(s)("详情")},null,8,["title"]),t("div",kt,[t("div",Nt,[t("div",Pt,[t("span",null,"# "+o(e(g)),1),t("span",{onClick:n[0]||(n[0]=et(y=>{var C;return e(T)("address",(C=e(u))==null?void 0:C.award)},["stop"]))},[t("span",null,o(e(s)("奖品"))+": "+o(("addressFl"in a?a.addressFl:e(_e))((ne=e(u))==null?void 0:ne.award)),1),w(j,{"class-prefix":"iconfont icon-jump text-white/60 ml-1"})])]),t("div",Ct,[t("div",null,[(se=e(u))!=null&&se.award?(d(),v("img",{key:0,class:"w-20 h-20",src:e(b)[(oe=e(u))==null?void 0:oe.award].icon,alt:""},null,8,It)):(d(),v("div",Bt))]),t("div",At,[t("div",Ut,[t("span",null,o(e(s)("总筹码"))+": ",1),t("span",null,o((le=e(u))==null?void 0:le.total),1)]),t("div",Ft,[t("span",null,o(e(s)("总下注"))+": ",1),t("span",null,o((re=e(u))==null?void 0:re.pour),1)]),t("div",Tt,[t("span",null,o(e(s)("已下注"))+": ",1),t("span",null,o(e(x)),1)]),t("div",Mt,[t("span",null,o(e(s)("概率"))+": ",1),t("span",$t,o(("formatNumber"in a?a.formatNumber:e(ye))(e(U),0,2))+"%",1)]),(ue=e(u))!=null&&ue.drawNum?(d(),v("div",qt,[t("div",null,o(e(s)("幸运数")),1),t("div",Lt,o((ie=e(u))==null?void 0:ie.drawNum),1)])):he("",!0)])])])]),t("div",St,o(e(s)("下注记录")),1),t("div",Rt,[t("div",Dt,[t("div",null,o(e(s)("排序")),1),t("div",null,o(e(s)("地址")),1),t("div",null,o(e(s)("数量")),1)]),t("div",Ht,[w(Te,{"model-value":e(R),onRefresh:e(S)},{default:G(()=>{var y,C;return[((C=(y=e(L))==null?void 0:y.pages[0])==null?void 0:C.list.length)===0?(d(),O(I,{key:0,image:"/empty.png",description:e(s)("暂无下注记录")},null,8,["description"])):(d(),O(Fe,{key:1,loading:e(K),finished:!e(i),"loading-text":e(s)("加载中")+"...","finished-text":e(s)("没有更多了"),onLoad:e(f)},{default:G(()=>{var $;return[t("div",jt,[(d(!0),v(Q,null,Z(($=e(L))==null?void 0:$.pages,(E,q)=>(d(),v(Q,{key:q},[(d(!0),v(Q,null,Z(E.list,(h,W)=>(d(),v("div",{key:W,class:pe(["flex justify-between my-2 py-1 px-3",e(A)(h)])},[t("div",null,o(q*Number(ee)+W+1),1),t("div",null,o(("addressFl"in a?a.addressFl:e(_e))(h.user)),1),t("div",null,o(h.amount),1)],2))),128))],64))),128))])]}),_:1},8,["loading","finished","loading-text","finished-text","onLoad"]))]}),_:1},8,["model-value","onRefresh"]),n[7]||(n[7]=t("div",{class:"h-[100px]"},null,-1))])]),t("div",null,[w($e,{height:e(H),"onUpdate:height":n[5]||(n[5]=y=>X(H)?H.value=y:null),anchors:D,onHeightChange:Ae,class:"!z-10"},{default:G(()=>{var y,C,$,E,q;return[t("div",Et,[t("div",Ot,[w(Me,{onFocus:n[1]||(n[1]=h=>Be()),modelValue:e(r),"onUpdate:modelValue":n[2]||(n[2]=h=>X(r)?r.value=h:null),class:"bg-transparent flex-1",placeholder:e(s)("请输入投入数量")},null,8,["modelValue","placeholder"]),(y=e(u))!=null&&y.award?(d(),v("img",{key:0,class:"w-8 h-8",src:e(l).tokenInfo.icon,alt:""},null,8,Qt)):he("",!0)]),t("div",null,[t("div",Vt,[(d(),v(Q,null,Z(Pe,h=>t("button",{key:h,class:"px-2 py-1 bg-transparent text-white border border-white/20 rounded",onClick:W=>r.value=Number(e(r))+h}," + "+o(h),9,zt)),64))])]),t("div",Kt,o(e(s)("账户筹码"))+": "+o(("formatNumber"in a?a.formatNumber:e(ye))(("formatUnit"in a?a.formatUnit:e(we))(e(l).balance))),1),e(Ce)?(d(),v("button",{key:1,class:pe(["btn-bg w-full h-9 bg-white text-black rounded-full font-bold",{"opacity-50":e(J)||Number(e(r)||0)<=0||!!((E=e(u))!=null&&E.drawNum)}]),onClick:n[4]||(n[4]=h=>e(Ue)()),disabled:e(J)||Number(e(r)||0)<=0||!!((q=e(u))!=null&&q.drawNum)},[e(J)?(d(),O(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Gt,o(e(s)("下注")),1))],10,Wt)):(d(),v("button",{key:0,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:n[3]||(n[3]=h=>P.value=!0),disabled:e(te)||Number(e(r)||0)<=0},[e(te)?(d(),O(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Jt,o(e(s)("授权"))+" "+o(($=(C=e(l))==null?void 0:C.tokenInfo)==null?void 0:$.symbol),1))],8,Yt))])]}),_:1},8,["height"])]),w(qe,{show:e(P),"onUpdate:show":n[6]||(n[6]=y=>X(P)?P.value=y:null),address:(de=e(l))==null?void 0:de.tokenInfo.address,amount:e(r)||0,approve:e(Ie)},null,8,["show","address","amount","approve"])])}}}),ca=gt(Xt,[["__scopeId","data-v-c4af8a31"]]);export{ca as default};

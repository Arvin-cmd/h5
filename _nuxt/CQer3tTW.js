import{_ as Le,s as Re}from"./Btxg4FkC.js";import{eq as De,d2 as Pe,dR as ve,e2 as me,dT as He,dK as je,cA as U,er as Ee,cB as p,e8 as Ve,es as fe,e4 as Ye,e6 as ze,et as he,eu as Qe,ee as Ke,c_ as w,ej as Oe,d3 as We,cz as Xe,ev as Ze,ew as Ge,d4 as Je,ex as et,cW as v,cY as t,d5 as e,cZ as o,df as tt,dg as at,ey as pe,c$ as Z,dY as G,de as V,d6 as Y,d7 as J,dX as ge,cX as d}from"./BWftuhBA.js";import{c as nt,Q as st,u as ot,s as lt,a as rt,b as ut}from"./gFEFojss.js";import{d as it,a as dt,_ as ct,s as _e,c as vt}from"./dFuH5_e5.js";import{o as mt,p as be,a as ye,b as we,f as xe}from"./CFtiEey3.js";import{t as ft,b as ke}from"./CcKT-9ls.js";import{u as ht}from"./DdryT4cB.js";import{u as pt}from"./DUeuwroF.js";import{a as gt}from"./B2hPhjug.js";import{u as _t}from"./1p_STghO.js";import{_ as bt}from"./DlAUqK2U.js";De(it);const yt={height:me(0),anchors:He(),duration:me(.3),contentDraggable:ve,lockScroll:Boolean,safeAreaInsetBottom:ve},[wt,z]=je("floating-panel");var xt=Pe({name:wt,props:yt,emits:["heightChange","update:height"],setup(m,{emit:$,slots:s}){const k=U(),c=U(),g=Ee(()=>+m.height,i=>$("update:height",i)),N=p(()=>{var i,f;return{min:(i=m.anchors[0])!=null?i:100,max:(f=m.anchors[m.anchors.length-1])!=null?f:Math.round(Ve.value*.6)}}),_=p(()=>m.anchors.length>=2?m.anchors:[N.value.min,N.value.max]),A=U(!1),u=p(()=>({height:fe(N.value.max),transform:`translateY(calc(100% + ${fe(-g.value)}))`,transition:A.value?"none":`transform ${m.duration}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`})),Q=i=>{const f=Math.abs(i),{min:l,max:r}=N.value;return f>r?-(r+(f-r)*.2):f<l?-(l-(l-f)*.2):i};let B,x=-1;const T=Ye(),S=i=>{T.start(i),A.value=!0,B=-g.value,x=-1},L=i=>{var f;T.move(i);const l=i.target;if(c.value===l||(f=c.value)!=null&&f.contains(l)){const{scrollTop:P}=c.value;if(x=Math.max(x,P),!m.contentDraggable)return;if(-B<N.value.max)Oe(i,!0);else if(!(P<=0&&T.deltaY.value>0)||x>0)return}const r=T.deltaY.value+B;g.value=-Q(r)},R=()=>{x=-1,A.value=!1,g.value=he(_.value,g.value),g.value!==-B&&$("heightChange",{height:g.value})};ze(N,()=>{g.value=he(_.value,g.value)},{immediate:!0}),Qe(k,()=>m.lockScroll||A.value),Ke("touchmove",L,{target:k});const K=()=>s.header?s.header():w("div",{class:z("header")},[w("div",{class:z("header-bar")},null)]);return()=>{var i;return w("div",{class:[z(),{"van-safe-area-bottom":m.safeAreaInsetBottom}],ref:k,style:u.value,onTouchstartPassive:S,onTouchend:R,onTouchcancel:R},[K(),w("div",{class:z("content"),ref:c},[(i=s.default)==null?void 0:i.call(s)])])}}});function Ne(m,$){return nt(st,m)}const kt={class:"h-screen flex flex-col font-[dinpro]"},Nt={class:"bg-[#2A2B30] mb-0 rounded-lg overflow-hidden m-3 border-bg"},Pt={class:"relative"},It={class:"py-2 px-3 home-bg flex justify-between"},Ct={class:"px-3 py-2 flex"},At=["src"],Bt={key:1,class:"w-20 h-20 animate-pulse rounded-full bg-white/50"},Tt={class:"pl-3 text-sm text-white/80 flex-1 grid grid-cols-2 content-start"},Ut={class:""},$t={class:"text-right"},Ft={class:""},Mt={class:"text-right"},qt={class:"text-theme"},St={key:0,class:"flex items-center justify-between mt-1 col-span-2"},Lt={class:"font-bold text-lg rounded lucky px-2 flex items-center justify-center"},Rt={class:"text-lg font-bold p-3"},Dt={class:"flex-1 overflow-hidden flex flex-col"},Ht={class:"flex justify-between mb-2 px-3"},jt={class:"flex-1 overflow-auto px-3"},Et={class:"divide-y divide-[#2A2B30] text-white/80"},Vt={class:"px-3 py-2"},Yt={class:"flex items-center border border-white/20 rounded-lg py-1 px-2 mb-3"},zt=["src"],Qt={class:"grid grid-cols-3 gap-2 mb-3"},Kt=["onClick"],Ot={class:"text-xs mb-3"},Wt=["disabled"],Xt={key:1},Zt=["disabled"],Gt={key:1},ee=30n,Jt=Pe({__name:"info",setup(m){const{openExplorer:$}=mt(),{t:s}=We(),{address:F}=Xe();gt({title:"UU竞拍 - 专属竞拍详情",ogTitle:"UU竞拍 | 竞争激烈的实时下注",description:"参与UU去中心化竞拍，查看实时下注情况，计算获胜概率，随时掌握竞拍动态。",ogDescription:"正在进行中的热门竞拍！查看实时下注情况，计算您的中奖概率。在UU竞拍平台，小额投入也有机会赢取ETH和热门代币，透明公正的链上竞争，立即参与！"});const k=Ze(),c=ht(),{tokenAddressMap:g}=ft(),{addBetRecord:N}=_t(),_=p(()=>BigInt(k.query.id||0)),A=p(()=>a=>{var b;const n=Number(((b=u.value)==null?void 0:b.drawNum)||0);return n>=a.start&&n<=a.end?"lucky rounded border-none text-black":""}),{data:u,refetch:Q}=Ne({queryKey:p(()=>["auctionInfo",k.query.id]),queryFn:async()=>{const a={user:"",award:"",total:0,pour:0,drawNum:0},n=await c.auctionInfo(_.value);return a.user=n[0],a.award=n[1],a.total=Number(n[2]),a.pour=Number(n[3]),n[2]==n[3]&&(a.drawNum=Number(await c.drawNum(_.value))),a}}),B=p(()=>!u.value||!x.value?0:Number(x.value||0)/(Number(u.value.total)||1)*100),{data:x,refetch:T}=Ne({queryKey:p(()=>["pourNum",k.query.id]),queryFn:async()=>c.pourNum(_.value,F.value),enabled:p(()=>!!F.value)}),{data:S,refetch:L,isRefetching:R,isFetching:K,hasNextPage:i,fetchNextPage:f}=ot({enabled:p(()=>!!F.value),queryKey:p(()=>["getPourList",k.query.id]),refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:a=>a.nextCursor,queryFn:async({pageParam:a=1})=>{const n=await c.getPourList(_.value,BigInt(a),ee),b={list:n[1].map(C=>({...C,amount:Number(C.end-C.start)+1,start:Number(C.start),end:Number(C.end)})),nextCursor:void 0};return(a-1)*Number(ee)+n[1].length<Number(n[0])&&(b.nextCursor=a+1),b}}),l=pt("UB"),r=U(null),P=U(!1),D=[100,300],H=U(D[0]),Ie=[1,5,10,50,100,500],{setShowMenu:O}=Ge();Je(()=>{F.value&&(l.balanceOf(),l.allowance(c.address.value),console.log("ubToken",l.allowanceMap.value[c.address.value]))});const Ce=p(()=>(l.allowanceMap.value[c.address.value]||0n)<be(r.value||0,l.tokenInfo.value.decimals)),{isPending:te,mutateAsync:Ae}=ke({mutationFn:async a=>{await l.approve(c.address.value,be(a,l.tokenInfo.value.decimals)),await l.allowance(c.address.value)}}),Be=()=>{O(!1),H.value=D[1]},Te=({height:a})=>{O(a==D[0])};et(()=>{O(!0)});const{isPending:W,mutateAsync:Ue}=ke({mutationFn:async()=>{var n,b;if(xe(l.balance.value,l.tokenInfo.value.decimals)<Number(r.value||0)){_e("余额不足");return}if(Number((n=u.value)==null?void 0:n.total)-Number((b=u.value)==null?void 0:b.pour)<Number(r.value||0)){_e("剩余数量不足");return}const a=vt({message:s("确认中")+"...",duration:0});try{P.value=!1,await c.pourAuction(BigInt(_.value),BigInt(r.value||0)),N(Number(_.value)),r.value=null,Q(),L(),T(),l.balanceOf(),l.allowance(c.address.value),a.open({type:"success",message:s("下注成功"),duration:2e3})}catch(j){a.open({type:"error",message:j.shortMessage||s("下注失败"),duration:2e3})}}});return(a,n)=>{var ne,se,oe,le,re,ue,ie,de,ce;const b=Le,j=at,C=rt,$e=ut,Fe=lt,Me=ct,ae=Re,qe=xt,Se=dt;return d(),v("div",kt,[w(b,{title:e(s)("详情")},null,8,["title"]),t("div",Nt,[t("div",Pt,[t("div",It,[t("span",null,"# "+o(e(_)),1),t("span",{onClick:n[0]||(n[0]=tt(y=>{var I;return e($)("address",(I=e(u))==null?void 0:I.award)},["stop"]))},[t("span",null,o(e(s)("奖品"))+": "+o(("addressFl"in a?a.addressFl:e(ye))((ne=e(u))==null?void 0:ne.award)),1),w(j,{"class-prefix":"iconfont icon-jump text-white/60 ml-1"})])]),t("div",Ct,[t("div",null,[(se=e(u))!=null&&se.award?(d(),v("img",{key:0,class:"w-20 h-20",src:e(g)[(oe=e(u))==null?void 0:oe.award].icon,alt:""},null,8,At)):(d(),v("div",Bt))]),t("div",Tt,[t("div",Ut,[t("span",null,o(e(s)("总筹码"))+": ",1),t("span",null,o((le=e(u))==null?void 0:le.total),1)]),t("div",$t,[t("span",null,o(e(s)("总下注"))+": ",1),t("span",null,o((re=e(u))==null?void 0:re.pour),1)]),t("div",Ft,[t("span",null,o(e(s)("已下注"))+": ",1),t("span",null,o(e(x)),1)]),t("div",Mt,[t("span",null,o(e(s)("概率"))+": ",1),t("span",qt,o(("formatNumber"in a?a.formatNumber:e(we))(e(B),0,2))+"%",1)]),(ue=e(u))!=null&&ue.drawNum?(d(),v("div",St,[t("div",null,o(e(s)("幸运数")),1),t("div",Lt,o((ie=e(u))==null?void 0:ie.drawNum),1)])):pe("",!0)])])])]),t("div",Rt,o(e(s)("下注记录")),1),t("div",Dt,[t("div",Ht,[t("div",null,o(e(s)("排序")),1),t("div",null,o(e(s)("地址")),1),t("div",null,o(e(s)("数量")),1)]),t("div",jt,[w(Fe,{"model-value":e(R),onRefresh:e(L)},{default:Z(()=>{var y,I;return[((I=(y=e(S))==null?void 0:y.pages[0])==null?void 0:I.list.length)===0?(d(),V(C,{key:0,image:"/empty.png",description:e(s)("暂无下注记录")},null,8,["description"])):(d(),V($e,{key:1,loading:e(K),finished:!e(i),"loading-text":e(s)("加载中")+"...","finished-text":e(s)("没有更多了"),onLoad:e(f)},{default:Z(()=>{var M;return[t("div",Et,[(d(!0),v(Y,null,J((M=e(S))==null?void 0:M.pages,(E,q)=>(d(),v(Y,{key:q},[(d(!0),v(Y,null,J(E.list,(h,X)=>(d(),v("div",{key:X,class:ge(["flex justify-between my-2 py-1 px-3",e(A)(h)])},[t("div",null,o(q*Number(ee)+X+1),1),t("div",null,o(("addressFl"in a?a.addressFl:e(ye))(h.user)),1),t("div",null,o(h.amount),1)],2))),128))],64))),128))])]}),_:1},8,["loading","finished","loading-text","finished-text","onLoad"]))]}),_:1},8,["model-value","onRefresh"]),n[7]||(n[7]=t("div",{class:"h-[100px]"},null,-1))])]),t("div",null,[w(qe,{height:e(H),"onUpdate:height":n[5]||(n[5]=y=>G(H)?H.value=y:null),anchors:D,onHeightChange:Te,class:"!z-10"},{default:Z(()=>{var y,I,M,E,q;return[t("div",Vt,[t("div",Yt,[w(Me,{onFocus:n[1]||(n[1]=h=>Be()),modelValue:e(r),"onUpdate:modelValue":n[2]||(n[2]=h=>G(r)?r.value=h:null),class:"bg-transparent flex-1",placeholder:e(s)("请输入投入数量")},null,8,["modelValue","placeholder"]),(y=e(u))!=null&&y.award?(d(),v("img",{key:0,class:"w-8 h-8",src:e(l).tokenInfo.value.icon,alt:""},null,8,zt)):pe("",!0)]),t("div",null,[t("div",Qt,[(d(),v(Y,null,J(Ie,h=>t("button",{key:h,class:"px-2 py-1 bg-transparent text-white border border-white/20 rounded",onClick:X=>r.value=Number(e(r))+h}," + "+o(h),9,Kt)),64))])]),t("div",Ot,o(e(s)("账户筹码"))+": "+o(("formatNumber"in a?a.formatNumber:e(we))(("formatUnit"in a?a.formatUnit:e(xe))(e(l).balance.value))),1),e(Ce)?(d(),v("button",{key:0,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:n[3]||(n[3]=h=>P.value=!0),disabled:e(te)||Number(e(r)||0)<=0},[e(te)?(d(),V(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Xt,o(e(s)("授权"))+" "+o((M=(I=e(l))==null?void 0:I.tokenInfo.value)==null?void 0:M.symbol),1))],8,Wt)):(d(),v("button",{key:1,class:ge(["btn-bg w-full h-9 bg-white text-black rounded-full font-bold",{"opacity-50":e(W)||Number(e(r)||0)<=0||!!((E=e(u))!=null&&E.drawNum)}]),onClick:n[4]||(n[4]=h=>e(Ue)()),disabled:e(W)||Number(e(r)||0)<=0||!!((q=e(u))!=null&&q.drawNum)},[e(W)?(d(),V(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Gt,o(e(s)("下注")),1))],10,Zt))])]}),_:1},8,["height"])]),w(Se,{show:e(P),"onUpdate:show":n[6]||(n[6]=y=>G(P)?P.value=y:null),address:(ce=(de=e(l))==null?void 0:de.tokenInfo.value)==null?void 0:ce.address,amount:e(r)||0,approve:e(Ae)},null,8,["show","address","amount","approve"])])}}}),ca=bt(Jt,[["__scopeId","data-v-d531f351"]]);export{ca as default};

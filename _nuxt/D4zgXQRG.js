import{L as ee,_ as te,s as se}from"./CLRq8USm.js";import{_ as ne,a as oe}from"./3QVovQFn.js";import{v as Q,ai as ae,aj as le,q as i,ak as ce,al as ie,am as re,an as N,ao as de,ap as ue,aq as A,ar as pe,as as fe,at as me,au as ve,x as ke,r as B,av as _e,c as V,m as _,n as l,y as e,p as u,J as L,K as be,s as he,aw as P,I as K,ax as E,w as we,o as v,F as ye,z as xe}from"./BZiRVSuw.js";import{f as j,a as q,c as z,s as I,p as J}from"./kZy2i8EF.js";import{t as Ie,b as R,c as ge}from"./Do0ZyUNZ.js";import{u as Ce}from"./BEG1h64H.js";import{u as G}from"./BpBY1PBC.js";import{a as Ue}from"./DvAM19PG.js";import"./DlAUqK2U.js";import"./CdUFFZON.js";const[Ae,f]=le("action-sheet"),Pe=ae({},ue,{title:String,round:A,actions:fe(),closeIcon:pe("cross"),closeable:A,cancelText:String,description:String,closeOnPopstate:A,closeOnClickAction:Boolean,safeAreaInsetBottom:A}),Te=[...ve,"round","closeOnPopstate","safeAreaInsetBottom"];var He=Q({name:Ae,props:Pe,emits:["select","cancel","update:show"],setup(p,{slots:t,emit:r}){const w=o=>r("update:show",o),g=()=>{w(!1),r("cancel")},k=()=>{if(p.title)return i("div",{class:f("header")},[p.title,p.closeable&&i(N,{name:p.closeIcon,class:[f("close"),de],onClick:g},null)])},b=()=>{if(t.cancel||p.cancelText)return[i("div",{class:f("gap")},null),i("button",{type:"button",class:f("cancel"),onClick:g},[t.cancel?t.cancel():p.cancelText])]},d=o=>{if(o.icon)return i(N,{class:f("item-icon"),name:o.icon},null)},n=(o,m)=>o.loading?i(ee,{class:f("loading-icon")},null):t.action?t.action({action:o,index:m}):[i("span",{class:f("name")},[o.name]),o.subname&&i("div",{class:f("subname")},[o.subname])],T=(o,m)=>{const{color:H,loading:h,callback:U,disabled:y,className:S}=o,s=()=>{y||h||(U&&U(o),p.closeOnClickAction&&w(!1),me(()=>r("select",o,m)))};return i("button",{type:"button",style:{color:H},class:[f("item",{loading:h,disabled:y}),S],onClick:s},[d(o),n(o,m)])},C=()=>{if(p.description||t.description){const o=t.description?t.description():p.description;return i("div",{class:f("description")},[o])}};return()=>i(re,ce({class:f(),position:"bottom","onUpdate:show":w},ie(p,Te)),{default:()=>{var o;return[k(),C(),i("div",{class:f("content")},[p.actions.map(T),(o=t.default)==null?void 0:o.call(t)]),b()]}})}});const Se={class:"h-screen w-screen flex flex-col"},Be={class:"mb-[20vw] flex-1 flex flex-col justify-center px-4"},Fe={class:"border-bg rounded-lg bg-white/30 p-3"},$e={class:"relative"},De={class:"text-xl font-bold text-center my-4"},Me={class:"mt-6 border border-white/30 rounded-md px-2 py-1 flex items-center"},Oe={class:"text-white/60"},Ne=["src"],Ve={class:"text-sm mr-4"},Le=["src"],Ke={class:"text-xs text-white/60 pl-3"},Ee={class:"text-xs text-white/60 ml-auto pr-2"},je={class:"flex items-center mt-2"},qe={class:"pr-2 ml-auto"},ze=["src"],Je={class:"mt-6"},Re=["disabled"],Ge={key:1},Qe={key:1},We={class:"p-4 divide-y divide-white/20"},Xe=["onClick"],Ye=["src"],Ze={class:"text-xs pl-2 flex-1"},et={class:"text-xs ml-auto pr-2"},ut=Q({__name:"add",setup(p){const{t}=ke();Ue({title:"UU"+t("竞拍")+" - "+t("创建您的专属竞拍"),ogTitle:"UU"+t("竞拍")+" | "+t("成为庄家")+"，"+t("开启您的区块链生意"),description:t("在")+"UU"+t("竞拍平台创建您的专属竞拍活动")+"，"+t("成为庄家")+"，"+t("自定义奖品和规则")+"，"+t("吸引玩家参与")+"。",ogDescription:t("想当老板")+"？"+t("在")+"UU"+t("竞拍平台创建您的专属竞拍")+"，"+t("自由设置奖品代币和开奖条件")+"。"+t("成为庄家")+"，"+t("享受设定规则的乐趣")+"，"+t("同时获得参与者的关注")+"。"+t("区块链技术保证公平透明")+"，"+t("立即开启您的第一场竞拍")+"！"});const r=Ce(),{tokenList:w}=Ie(),g=["USDT"],k=G("UB");k.balanceOf(),k.allowance(r.address.value);const b=B(!1),d=_e({award:k.tokenInfo.value.address,total:null}),n=B({...k}),T=w.value.filter(s=>!g.includes(s.symbol)).map(s=>G(s.symbol)),C=V(()=>d.total?n.value.tokenInfo.symbol=="UB"?d.total:1:0),o=V(()=>j(n.value.allowanceMap[r.address.value]||0n,n.value.tokenInfo.decimals)>=C.value),m=B(!1),H=async s=>{d.award=s.tokenInfo.value.address,n.value=s,m.value=!1,s.balance.value||await s.balanceOf(),s.allowanceMap.value[r.address.value]||await s.allowance(r.address.value)},{isPending:h,mutateAsync:U}=R({mutationFn:async s=>{var a,x;if(!s){I("请输入有效金额");return}await((a=n.value)==null?void 0:a.approve(r.address.value,J(s,n.value.tokenInfo.decimals))),await((x=n.value)==null?void 0:x.allowance(r.address.value)),console.log("token.value.allowanceMap[auctionHook.address.value]",n.value.allowanceMap[r.address.value])}}),{isPending:y,mutate:S}=R({mutationFn:async()=>{const{award:s,total:a}=d;if(!a)return I("请输入开奖数量");if(a<2)return I(t("开奖筹码数量不能少于")+"2");if(n){if(J(n.value.tokenInfo.symbol=="UB"?a:1,n.value.tokenInfo.decimals)>n.value.balance)return I("筹码余额不足");await r.userAddAuction(s,BigInt(a)),n.value.balanceOf(),n.value.allowance(r.address.value),d.total=null}else return I("错误代币");ge()}});return(s,a)=>{var D,M,O;const x=te,W=ne,F=be,$=se,X=oe,Y=He;return v(),_("div",Se,[i(x,{title:e(t)("创建拍卖")},null,8,["title"]),l("div",Be,[a[7]||(a[7]=l("div",{class:"text-center text-xl mb-4"},"Create Auction",-1)),l("div",Fe,[l("div",$e,[l("div",De,u(e(t)("创建拍卖")),1),l("div",Me,[l("div",Oe,u(e(t)("开奖筹码")),1),i(W,{modelValue:e(d).total,"onUpdate:modelValue":a[0]||(a[0]=c=>e(d).total=c),class:"bg-transparent text-white flex-1 w-1 text-right h-10",placeholder:"0"},null,8,["modelValue"]),l("img",{class:"w-10 h-10 ml-3",src:e(k).tokenInfo.value.icon,alt:""},null,8,Ne)]),l("div",{class:"flex items-center my-3 border border-white/30 rounded-md px-2 py-1",onClick:a[2]||(a[2]=c=>m.value=!0)},[l("div",Ve,u(e(t)("奖品选择")),1),l("img",{class:"w-8 h-8",src:e(n).tokenInfo.icon,alt:""},null,8,Le),l("div",Ke,u(e(n).tokenInfo.symbol),1),l("div",Ee,u(("addressFl"in s?s.addressFl:e(q))(e(n).tokenInfo.address)),1),i(F,{"class-prefix":"iconfont icon-copy text-white/60",onClick:a[1]||(a[1]=L(c=>("copyHandle"in s?s.copyHandle:e(z))(e(n).tokenInfo.address),["stop"]))})]),l("div",je,[l("div",null,u(e(t)("余额"))+":",1),l("div",qe," x "+u(("formatUnit"in s?s.formatUnit:e(j))((D=e(n))==null?void 0:D.balance,(M=e(n))==null?void 0:M.tokenInfo.decimals)),1),l("img",{class:"w-5 h-5",src:e(n).tokenInfo.icon,alt:""},null,8,ze)]),l("div",Je,[he(u(e(o))+" ",1),e(o)?(v(),_("button",{key:1,class:P(["btn-bg text-black rounded-full w-full h-10 font-bold",{"opacity-50":e(y)||!e(d).total}]),onClick:a[4]||(a[4]=c=>e(S)())},[e(y)?(v(),K($,{key:0,type:"spinner",color:"#000"})):(v(),_("span",Qe,u(e(t)("创建")),1))],2)):(v(),_("button",{key:0,class:P(["btn-bg w-full h-10 text-black rounded-full font-bold",{"opacity-50":e(h)||!e(d).total}]),onClick:a[3]||(a[3]=c=>b.value=!0),disabled:e(h)||Number(e(d).total)<=0},[e(h)?(v(),K($,{key:0,type:"spinner",color:"#000"})):(v(),_("span",Ge,u(e(t)("授权"))+" "+u(e(n).tokenInfo.symbol),1))],10,Re))])])])]),i(X,{show:e(b),"onUpdate:show":a[5]||(a[5]=c=>E(b)?b.value=c:null),address:(O=e(d))==null?void 0:O.award,amount:e(C),approve:e(U)},null,8,["show","address","amount","approve"]),i(Y,{show:e(m),"onUpdate:show":a[6]||(a[6]=c=>E(m)?m.value=c:null),title:e(t)("选择奖品代币")},{default:we(()=>[l("div",We,[(v(!0),_(ye,null,xe(e(T),c=>(v(),_("div",{class:P(["flex items-center py-2",{"text-white/60":c.tokenInfo.value.address!==e(n).tokenInfo.address}]),key:c.tokenInfo.value.address,onClick:Z=>H(c)},[l("img",{class:P(["w-8 h-8",{grayscale:c.tokenInfo.value.address!==e(n).tokenInfo.address}]),src:c.tokenInfo.value.icon,alt:""},null,10,Ye),l("div",Ze,u(c.tokenInfo.value.symbol),1),l("div",et,u(("addressFl"in s?s.addressFl:e(q))(c.tokenInfo.value.address)),1),i(F,{"class-prefix":"iconfont icon-copy",onClick:L(Z=>("copyHandle"in s?s.copyHandle:e(z))(c.tokenInfo.value.address),["stop"])},null,8,["onClick"])],10,Xe))),128))])]),_:1},8,["show","title"])])}}});export{ut as default};

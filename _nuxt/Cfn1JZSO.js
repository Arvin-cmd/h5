import{_ as De,s as He}from"./C1sHKuLU.js";import{y as Ce,av as ve,bd as fe,ax as Se,ao as Le,r as B,bw as Re,e as g,bi as We,bx as he,bf as je,aD as ze,by as pe,bz as Ve,bo as Oe,v as w,bt as Qe,z as Ee,c as Ye,bA as Ke,bB as Ge,A as Je,bC as Xe,n as v,q as t,B as e,s,O as Ze,P as et,bD as ge,w as K,aC as G,N as W,F as j,C as J,aB as be,p as d}from"./BAumNzA0.js";import{c as tt,Q as at,u as nt,s as st,a as ot,b as lt}from"./CB0RzM7m.js";import{a as rt,_ as ut}from"./BUoiaHVL.js";import{p as _e,c as it,a as ye,b as we,f as xe,s as ke,d as dt}from"./CtEefc1e.js";import{t as ct,b as Ne}from"./gYml6LKr.js";import{u as mt}from"./giBQ5HTA.js";import{u as vt}from"./hZ89RS-S.js";import{a as ft}from"./BFu5KGiT.js";import{u as ht}from"./CwyvtLZ2.js";import{_ as pt}from"./DlAUqK2U.js";import"./C-6VqVVC.js";const gt={height:fe(0),anchors:Se(),duration:fe(.3),contentDraggable:ve,lockScroll:Boolean,safeAreaInsetBottom:ve},[bt,z]=Le("floating-panel");var _t=Ce({name:bt,props:gt,emits:["heightChange","update:height"],setup(f,{emit:o,slots:x}){const c=B(),U=B(),b=Re(()=>+f.height,i=>o("update:height",i)),m=g(()=>{var i,h;return{min:(i=f.anchors[0])!=null?i:100,max:(h=f.anchors[f.anchors.length-1])!=null?h:Math.round(We.value*.6)}}),$=g(()=>f.anchors.length>=2?f.anchors:[m.value.min,m.value.max]),r=B(!1),V=g(()=>({height:he(m.value.max),transform:`translateY(calc(100% + ${he(-b.value)}))`,transition:r.value?"none":`transform ${f.duration}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`})),O=i=>{const h=Math.abs(i),{min:l,max:u}=m.value;return h>u?-(u+(h-u)*.2):h<l?-(l-(l-h)*.2):i};let k,C=-1;const I=je(),Z=i=>{I.start(i),r.value=!0,k=-b.value,C=-1},q=i=>{var h;I.move(i);const l=i.target;if(U.value===l||(h=U.value)!=null&&h.contains(l)){const{scrollTop:N}=U.value;if(C=Math.max(C,N),!f.contentDraggable)return;if(-k<m.value.max)Qe(i,!0);else if(!(N<=0&&I.deltaY.value>0)||C>0)return}const u=I.deltaY.value+k;b.value=-O(u)},D=()=>{C=-1,r.value=!1,b.value=pe($.value,b.value),b.value!==-k&&o("heightChange",{height:b.value})};ze(m,()=>{b.value=pe($.value,b.value)},{immediate:!0}),Ve(c,()=>f.lockScroll||r.value),Oe("touchmove",q,{target:c});const Q=()=>x.header?x.header():w("div",{class:z("header")},[w("div",{class:z("header-bar")},null)]);return()=>{var i;return w("div",{class:[z(),{"van-safe-area-bottom":f.safeAreaInsetBottom}],ref:c,style:V.value,onTouchstartPassive:Z,onTouchend:D,onTouchcancel:D},[Q(),w("div",{class:z("content"),ref:U},[(i=x.default)==null?void 0:i.call(x)])])}}});function Pe(f,o){return tt(at,f)}const yt={class:"h-screen flex flex-col font-[dinpro]"},wt={class:"bg-[#2A2B30] mb-0 rounded-lg overflow-hidden m-3 border-bg"},xt={class:"relative"},kt={class:"py-2 px-3 home-bg flex justify-between"},Nt={class:"px-3 py-2 flex"},Pt=["src"],Ct={key:1,class:"w-20 h-20 animate-pulse rounded-full bg-white/50"},It={class:"pl-3 text-sm text-white/80 flex-1 grid grid-cols-2 content-start"},At={class:""},Bt={class:"text-right"},Ut={class:""},Ft={class:"text-right"},Tt={class:"text-theme"},Mt={key:0,class:"flex items-center justify-between mt-1 col-span-2"},$t={class:"font-bold text-lg rounded lucky px-2 flex items-center justify-center"},qt={class:"text-lg font-bold p-3"},Dt={class:"flex-1 overflow-hidden flex flex-col"},Ht={class:"flex justify-between mb-2 px-3"},St={class:"flex-1 overflow-auto px-3"},Lt={class:"divide-y divide-[#2A2B30] text-white/80"},Rt={class:"px-3 py-2"},Wt={class:"flex items-center border border-white/20 rounded-lg py-1 px-2 mb-3"},jt=["src"],zt={class:"grid grid-cols-3 gap-2 mb-3"},Vt=["onClick"],Ot={class:"text-xs mb-3"},Qt=["disabled"],Et={key:1},Yt=["disabled"],Kt={key:1},X=30n,Gt=Ce({__name:"info",setup(f){const{t:o}=Ee(),{address:x}=Ye();ft({title:"UU竞拍 - 专属竞拍详情",ogTitle:"UU竞拍 | 竞争激烈的实时下注",description:"参与UU去中心化竞拍，查看实时下注情况，计算获胜概率，随时掌握竞拍动态。",ogDescription:"正在进行中的热门竞拍！查看实时下注情况，计算您的中奖概率。在UU竞拍平台，小额投入也有机会赢取ETH和热门代币，透明公正的链上竞争，立即参与！"});const T=Ke(),c=mt(),{tokenAddressMap:U}=ct(),{addBetRecord:b}=ht(),m=g(()=>BigInt(T.query.id||0)),$=g(()=>a=>{var p;const n=Number(((p=r.value)==null?void 0:p.drawNum)||0);return n>=a.startWeight&&n<=a.endWeight?"lucky rounded border-none text-black":""}),{data:r,refetch:V}=Pe({queryKey:g(()=>["auctionInfo",T.query.id]),queryFn:async()=>{const a={user:"",award:"",total:0,pour:0,drawNum:0},n=await c.auctionInfo(m.value);return a.user=n[0],a.award=n[1],a.total=Number(n[2]),a.pour=Number(n[3]),n[2]==n[3]&&(a.drawNum=Number(await c.drawNum(m.value))),a}}),O=g(()=>!r.value||!k.value?0:Number(k.value||0)/(Number(r.value.total)||1)*100),{data:k,refetch:C}=Pe({queryKey:g(()=>["pourNum",T.query.id]),queryFn:async()=>c.pourNum(m.value,x.value),enabled:g(()=>!!x.value)}),{data:I,isPending:Z,refetch:q,isRefetching:D,isFetching:Q,hasNextPage:i,fetchNextPage:h}=nt({enabled:g(()=>!!x.value),queryKey:g(()=>["getPourList",T.query.id]),refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:a=>a.nextCursor,queryFn:async({pageParam:a=1})=>{const n=await c.getPourList(m.value,BigInt(a),X),p={list:n[1].map((A,ae)=>({...A,amount:Number(A.amount),startWeight:0,endWeight:0})),nextCursor:void 0};let F=0;return p.list=p.list.map(A=>({...A,startWeight:F+1,endWeight:F+=A.amount})),(a-1)*Number(X)+n[1].length<Number(n[0])&&(p.nextCursor=a+1),p}}),l=B(vt("UB")),u=B(null),N=B(!1),H=[100,300],S=B(H[0]),Ie=[1,5,10,50,100,500],{setShowMenu:E}=Ge();Je(()=>{x.value&&(l.value.balanceOf(),l.value.allowance(c.address.value))});const Ae=g(()=>l.value.allowanceMap[c.address.value]||0n>=_e(u.value||0,l.value.tokenInfo.decimals)),{isPending:ee,mutateAsync:Be}=Ne({mutationFn:async a=>{await l.value.approve(c.address.value,_e(a,l.value.tokenInfo.decimals)),await l.value.allowance(c.address.value)}}),Ue=()=>{E(!1),S.value=H[1]},Fe=({height:a})=>{E(a==H[0])};Xe(()=>{E(!0)});const{isPending:Y,mutateAsync:Te}=Ne({mutationFn:async()=>{var n,p;if(xe(l.value.balance,l.value.tokenInfo.decimals)<Number(u.value||0)){ke("余额不足");return}if(Number((n=r.value)==null?void 0:n.total)-Number((p=r.value)==null?void 0:p.pour)<Number(u.value||0)){ke("剩余数量不足");return}const a=dt({message:o("确认中")+"...",duration:0});try{N.value=!1,await c.pourAuction(BigInt(m.value),BigInt(u.value||0)),b(Number(m.value)),u.value=null,V(),q(),C(),l.value.balanceOf(),l.value.allowance(c.address.value),a.open({type:"success",message:o("下注成功"),duration:2e3})}catch(F){a.open({type:"error",message:F.shortMessage||o("下注失败"),duration:2e3})}}});return(a,n)=>{var se,oe,le,re,ue,ie,de,ce;const p=De,F=et,te=ot,A=lt,ae=st,Me=ut,ne=He,$e=_t,qe=rt;return d(),v("div",yt,[w(p,{title:e(o)("详情")},null,8,["title"]),t("div",wt,[t("div",xt,[t("div",kt,[t("span",null,"# "+s(e(m)),1),t("span",{onClick:n[0]||(n[0]=Ze(y=>{var P;return("copyHandle"in a?a.copyHandle:e(it))((P=e(r))==null?void 0:P.award)},["stop"]))},[t("span",null,s(e(o)("奖品"))+": "+s(("addressFl"in a?a.addressFl:e(ye))((se=e(r))==null?void 0:se.award)),1),w(F,{"class-prefix":"iconfont icon-copy text-white/60 ml-1"})])]),t("div",Nt,[t("div",null,[(oe=e(r))!=null&&oe.award?(d(),v("img",{key:0,class:"w-20 h-20",src:e(U)[(le=e(r))==null?void 0:le.award].icon,alt:""},null,8,Pt)):(d(),v("div",Ct))]),t("div",It,[t("div",At,[t("span",null,s(e(o)("总筹码"))+": ",1),t("span",null,s((re=e(r))==null?void 0:re.total),1)]),t("div",Bt,[t("span",null,s(e(o)("总下注"))+": ",1),t("span",null,s((ue=e(r))==null?void 0:ue.pour),1)]),t("div",Ut,[t("span",null,s(e(o)("已下注"))+": ",1),t("span",null,s(e(k)),1)]),t("div",Ft,[t("span",null,s(e(o)("概率"))+": ",1),t("span",Tt,s(("formatNumber"in a?a.formatNumber:e(we))(e(O),0,2))+"%",1)]),(ie=e(r))!=null&&ie.drawNum?(d(),v("div",Mt,[t("div",null,s(e(o)("幸运数")),1),t("div",$t,s((de=e(r))==null?void 0:de.drawNum),1)])):ge("",!0)])])])]),t("div",qt,s(e(o)("下注记录")),1),t("div",Dt,[t("div",Ht,[t("div",null,s(e(o)("排序")),1),t("div",null,s(e(o)("地址")),1),t("div",null,s(e(o)("数量")),1)]),t("div",St,[w(ae,{"model-value":e(D),onRefresh:e(q)},{default:K(()=>{var y,P;return[((P=(y=e(I))==null?void 0:y.pages[0])==null?void 0:P.list.length)===0?(d(),W(te,{key:0,image:"/empty.png",description:e(o)("暂无下注记录")},null,8,["description"])):(d(),W(A,{key:1,loading:e(Q),finished:!e(i),"loading-text":e(o)("加载中")+"...","finished-text":e(o)("没有更多了"),onLoad:e(h)},{default:K(()=>{var M;return[t("div",Lt,[(d(!0),v(j,null,J((M=e(I))==null?void 0:M.pages,(L,_)=>(d(),v(j,{key:_},[(d(!0),v(j,null,J(L.list,(R,me)=>(d(),v("div",{key:me,class:be(["flex justify-between my-2 py-1 px-3",e($)(R)])},[t("div",null,s(_*Number(X)+me+1),1),t("div",null,s(("addressFl"in a?a.addressFl:e(ye))(R.user)),1),t("div",null,s(R.amount),1)],2))),128))],64))),128))])]}),_:1},8,["loading","finished","loading-text","finished-text","onLoad"]))]}),_:1},8,["model-value","onRefresh"]),n[7]||(n[7]=t("div",{class:"h-[100px]"},null,-1))])]),t("div",null,[w($e,{height:e(S),"onUpdate:height":n[5]||(n[5]=y=>G(S)?S.value=y:null),anchors:H,onHeightChange:Fe,class:"!z-10"},{default:K(()=>{var y,P,M,L;return[t("div",Rt,[t("div",Wt,[w(Me,{onFocus:n[1]||(n[1]=_=>Ue()),modelValue:e(u),"onUpdate:modelValue":n[2]||(n[2]=_=>G(u)?u.value=_:null),class:"bg-transparent flex-1",placeholder:e(o)("请输入投入数量")},null,8,["modelValue","placeholder"]),(y=e(r))!=null&&y.award?(d(),v("img",{key:0,class:"w-8 h-8",src:e(l).tokenInfo.icon,alt:""},null,8,jt)):ge("",!0)]),t("div",null,[t("div",zt,[(d(),v(j,null,J(Ie,_=>t("button",{key:_,class:"px-2 py-1 bg-transparent text-white border border-white/20 rounded",onClick:R=>u.value=Number(e(u))+_}," + "+s(_),9,Vt)),64))])]),t("div",Ot,s(e(o)("账户筹码"))+": "+s(("formatNumber"in a?a.formatNumber:e(we))(("formatUnit"in a?a.formatUnit:e(xe))(e(l).balance))),1),e(Ae)?(d(),v("button",{key:1,class:be(["btn-bg w-full h-9 bg-white text-black rounded-full font-bold",{"opacity-50":e(Y)||Number(e(u)||0)<=0||!!((M=e(r))!=null&&M.drawNum)}]),onClick:n[4]||(n[4]=_=>e(Te)()),disabled:e(Y)||Number(e(u)||0)<=0||!!((L=e(r))!=null&&L.drawNum)},[e(Y)?(d(),W(ne,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Kt,s(e(o)("下注")),1))],10,Yt)):(d(),v("button",{key:0,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:n[3]||(n[3]=_=>N.value=!0),disabled:e(ee)||Number(e(u)||0)<=0},[e(ee)?(d(),W(ne,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Et,s(e(o)("授权"))+" "+s((P=e(l))==null?void 0:P.tokenInfo.symbol),1))],8,Qt))])]}),_:1},8,["height"])]),w(qe,{show:e(N),"onUpdate:show":n[6]||(n[6]=y=>G(N)?N.value=y:null),address:(ce=e(l))==null?void 0:ce.tokenInfo.address,amount:e(u)||0,approve:e(Be)},null,8,["show","address","amount","approve"])])}}}),ia=pt(Gt,[["__scopeId","data-v-1be6ceac"]]);export{ia as default};

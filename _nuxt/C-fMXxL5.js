import{L as te,_ as se,s as ne}from"./C1sHKuLU.js";import{_ as oe,a as ae}from"./BUoiaHVL.js";import{y as W,an as le,ao as ce,v as i,ap as ie,aq as re,ar as de,as as M,at as ue,au as pe,av as P,aw as fe,ax as me,ay as ve,az as ke,z as _e,c as he,A as be,r as F,aA as we,e as V,n as _,q as a,B as e,s as p,O as E,P as ye,aB as B,N as z,aC as K,w as xe,p as m,F as Ie,C as ge}from"./BAumNzA0.js";import{f as q,a as j,c as R,s as I,p as G}from"./CtEefc1e.js";import{t as Ce,b as J,c as Ae}from"./gYml6LKr.js";import{u as Ue}from"./giBQ5HTA.js";import{u as Q}from"./hZ89RS-S.js";import{a as Pe}from"./BFu5KGiT.js";import"./DlAUqK2U.js";import"./C-6VqVVC.js";const[Be,f]=ce("action-sheet"),Se=le({},pe,{title:String,round:P,actions:me(),closeIcon:fe("cross"),closeable:P,cancelText:String,description:String,closeOnPopstate:P,closeOnClickAction:Boolean,safeAreaInsetBottom:P}),Te=[...ke,"round","closeOnPopstate","safeAreaInsetBottom"];var He=W({name:Be,props:Se,emits:["select","cancel","update:show"],setup(d,{slots:l,emit:h}){const u=n=>h("update:show",n),g=()=>{u(!1),h("cancel")},S=()=>{if(d.title)return i("div",{class:f("header")},[d.title,d.closeable&&i(M,{name:d.closeIcon,class:[f("close"),ue],onClick:g},null)])},v=()=>{if(l.cancel||d.cancelText)return[i("div",{class:f("gap")},null),i("button",{type:"button",class:f("cancel"),onClick:g},[l.cancel?l.cancel():d.cancelText])]},b=n=>{if(n.icon)return i(M,{class:f("item-icon"),name:n.icon},null)},r=(n,w)=>n.loading?i(te,{class:f("loading-icon")},null):l.action?l.action({action:n,index:w}):[i("span",{class:f("name")},[n.name]),n.subname&&i("div",{class:f("subname")},[n.subname])],s=(n,w)=>{const{color:k,loading:C,callback:y,disabled:A,className:U}=n,H=()=>{A||C||(y&&y(n),d.closeOnClickAction&&u(!1),ve(()=>h("select",n,w)))};return i("button",{type:"button",style:{color:k},class:[f("item",{loading:C,disabled:A}),U],onClick:H},[b(n),r(n,w)])},T=()=>{if(d.description||l.description){const n=l.description?l.description():d.description;return i("div",{class:f("description")},[n])}};return()=>i(de,ie({class:f(),position:"bottom","onUpdate:show":u},re(d,Te)),{default:()=>{var n;return[S(),T(),i("div",{class:f("content")},[d.actions.map(s),(n=l.default)==null?void 0:n.call(l)]),v()]}})}});const Fe={class:"h-screen w-screen flex flex-col"},$e={class:"mb-[20vw] flex-1 flex flex-col justify-center px-4"},Oe={class:"border-bg rounded-lg bg-white/30 p-3"},De={class:"relative"},Ne={class:"text-xl font-bold text-center my-4"},Le={class:"mt-6 border border-white/30 rounded-md px-2 py-1 flex items-center"},Me={class:"text-white/60"},Ve=["src"],Ee={class:"text-sm mr-4"},ze=["src"],Ke={class:"text-xs text-white/60 pl-3"},qe={class:"text-xs text-white/60 ml-auto pr-2"},je={class:"flex items-center mt-2"},Re={class:"pr-2 ml-auto"},Ge=["src"],Je={class:"mt-6"},Qe=["disabled"],We={key:1},Xe={key:1},Ye={class:"p-4 divide-y divide-white/20"},Ze=["onClick"],et=["src"],tt={class:"text-xs pl-2 flex-1"},st={class:"text-xs ml-auto pr-2"},ft=W({__name:"add",setup(d){const{t:l}=_e(),{address:h}=he();Pe({title:"UU竞拍 - 创建您的专属竞拍",ogTitle:"UU竞拍 | 成为庄家，开启您的区块链生意",description:"在UU竞拍平台创建您的专属竞拍活动，成为庄家，自定义奖品和规则，吸引玩家参与。",ogDescription:"想当老板？在UU竞拍平台创建您的专属竞拍，自由设置奖品代币和开奖条件。成为庄家，享受设定规则的乐趣，同时获得参与者的关注。区块链技术保证公平透明，立即开启您的第一场竞拍！"});const u=Ue(),{tokenList:g}=Ce(),S=["USDT"],v=Q("UB");be(()=>{h.value&&(v.balanceOf(),v.allowance(u.address.value))});const b=F(!1),r=we({award:v.tokenInfo.value.address,total:null}),s=F({...v}),T=g.value.filter(t=>!S.includes(t.symbol)).map(t=>Q(t.symbol)),n=V(()=>r.total?s.value.tokenInfo.symbol=="UB"?r.total:1:0),w=V(()=>q(s.value.allowanceMap[u.address.value]||0n,s.value.tokenInfo.decimals)>=n.value),k=F(!1),C=async t=>{r.award=t.tokenInfo.value.address,s.value=t,k.value=!1,h.value&&(t.balance.value||await t.balanceOf(),t.allowanceMap.value[u.address.value]||await t.allowance(u.address.value))},{isPending:y,mutateAsync:A}=J({mutationFn:async t=>{var o,x;if(!t){I("请输入有效金额");return}await((o=s.value)==null?void 0:o.approve(u.address.value,G(t,s.value.tokenInfo.decimals))),await((x=s.value)==null?void 0:x.allowance(u.address.value))}}),{isPending:U,mutate:H}=J({mutationFn:async()=>{const{award:t,total:o}=r;if(!o)return I("请输入开奖数量");if(o<2)return I(l("开奖筹码数量不能少于")+"2");if(s){if(G(s.value.tokenInfo.symbol=="UB"?o:1,s.value.tokenInfo.decimals)>s.value.balance)return I("筹码余额不足");await u.userAddAuction(t,BigInt(o)),s.value.balanceOf(),s.value.allowance(u.address.value),r.total=null}else return I("错误代币");Ae()}});return(t,o)=>{var D,N,L;const x=se,X=oe,$=ye,O=ne,Y=ae,Z=He;return m(),_("div",Fe,[i(x,{title:e(l)("创建拍卖")},null,8,["title"]),a("div",$e,[o[7]||(o[7]=a("div",{class:"text-center text-xl mb-4"},"Create Auction",-1)),a("div",Oe,[a("div",De,[a("div",Ne,p(e(l)("创建拍卖")),1),a("div",Le,[a("div",Me,p(e(l)("开奖筹码")),1),i(X,{modelValue:e(r).total,"onUpdate:modelValue":o[0]||(o[0]=c=>e(r).total=c),class:"bg-transparent text-white flex-1 w-1 text-right h-10",placeholder:"0"},null,8,["modelValue"]),a("img",{class:"w-10 h-10 ml-3",src:e(v).tokenInfo.value.icon,alt:""},null,8,Ve)]),a("div",{class:"flex items-center my-3 border border-white/30 rounded-md px-2 py-1",onClick:o[2]||(o[2]=c=>k.value=!0)},[a("div",Ee,p(e(l)("奖品选择")),1),a("img",{class:"w-8 h-8",src:e(s).tokenInfo.icon,alt:""},null,8,ze),a("div",Ke,p(e(s).tokenInfo.symbol),1),a("div",qe,p(("addressFl"in t?t.addressFl:e(j))(e(s).tokenInfo.address)),1),i($,{"class-prefix":"iconfont icon-copy text-white/60",onClick:o[1]||(o[1]=E(c=>("copyHandle"in t?t.copyHandle:e(R))(e(s).tokenInfo.address),["stop"]))})]),a("div",je,[a("div",null,p(e(l)("余额"))+":",1),a("div",Re," x "+p(("formatUnit"in t?t.formatUnit:e(q))((D=e(s))==null?void 0:D.balance,(N=e(s))==null?void 0:N.tokenInfo.decimals)),1),a("img",{class:"w-5 h-5",src:e(s).tokenInfo.icon,alt:""},null,8,Ge)]),a("div",Je,[e(w)?(m(),_("button",{key:1,class:B(["btn-bg text-black rounded-full w-full h-10 font-bold",{"opacity-50":e(U)||!e(r).total}]),onClick:o[4]||(o[4]=c=>e(H)())},[e(U)?(m(),z(O,{key:0,type:"spinner",color:"#000"})):(m(),_("span",Xe,p(e(l)("创建")),1))],2)):(m(),_("button",{key:0,class:B(["btn-bg w-full h-10 text-black rounded-full font-bold",{"opacity-50":e(y)||!e(r).total}]),onClick:o[3]||(o[3]=c=>b.value=!0),disabled:e(y)||Number(e(r).total)<=0},[e(y)?(m(),z(O,{key:0,type:"spinner",color:"#000"})):(m(),_("span",We,p(e(l)("授权"))+" "+p(e(s).tokenInfo.symbol),1))],10,Qe))])])])]),i(Y,{show:e(b),"onUpdate:show":o[5]||(o[5]=c=>K(b)?b.value=c:null),address:(L=e(r))==null?void 0:L.award,amount:e(n),approve:e(A)},null,8,["show","address","amount","approve"]),i(Z,{show:e(k),"onUpdate:show":o[6]||(o[6]=c=>K(k)?k.value=c:null),title:e(l)("选择奖品代币")},{default:xe(()=>[a("div",Ye,[(m(!0),_(Ie,null,ge(e(T),c=>(m(),_("div",{class:B(["flex items-center py-2",{"text-white/60":c.tokenInfo.value.address!==e(s).tokenInfo.address}]),key:c.tokenInfo.value.address,onClick:ee=>C(c)},[a("img",{class:B(["w-8 h-8",{grayscale:c.tokenInfo.value.address!==e(s).tokenInfo.address}]),src:c.tokenInfo.value.icon,alt:""},null,10,et),a("div",tt,p(c.tokenInfo.value.symbol),1),a("div",st,p(("addressFl"in t?t.addressFl:e(j))(c.tokenInfo.value.address)),1),i($,{"class-prefix":"iconfont icon-copy",onClick:E(ee=>("copyHandle"in t?t.copyHandle:e(R))(c.tokenInfo.value.address),["stop"])},null,8,["onClick"])],10,Ze))),128))])]),_:1},8,["show","title"])])}}});export{ft as default};

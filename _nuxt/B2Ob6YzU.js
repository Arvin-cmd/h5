import{_ as Se,s as Re}from"./DttBTQhN.js";import{bJ as De,y as Pe,av as ve,b8 as me,ax as He,ao as je,r as T,bK as Ee,e as p,be as Oe,bL as fe,ba as Qe,bc as Ve,bM as he,bN as ze,bk as Ke,v as w,bp as Ye,z as Je,c as We,bO as Ge,bP as Xe,A as Ze,bQ as et,n as v,q as t,B as e,s as o,O as tt,P as at,bR as pe,w as G,aC as X,N as O,F as Q,C as Z,aB as be,p as d}from"./riPymW3M.js";import{c as nt,Q as st,u as ot,s as lt,a as rt,b as ut}from"./DZ6mmShV.js";import{d as it,a as dt,_ as ct,s as ge,c as vt}from"./D-_9ru_Q.js";import{o as mt,p as _e,a as ye,b as we,f as xe}from"./XXTYGTbl.js";import{t as ft,b as ke}from"./CRZOKbAF.js";import{u as ht}from"./7b4zzCzZ.js";import{u as pt}from"./MNP8_Z6Z.js";import{a as bt}from"./CKKhEfdK.js";import{u as gt}from"./DIto6Gfk.js";import{_ as _t}from"./DlAUqK2U.js";import"./DJz_k-9G.js";De(it);const yt={height:me(0),anchors:He(),duration:me(.3),contentDraggable:ve,lockScroll:Boolean,safeAreaInsetBottom:ve},[wt,V]=je("floating-panel");var xt=Pe({name:wt,props:yt,emits:["heightChange","update:height"],setup(m,{emit:F,slots:s}){const k=T(),c=T(),b=Ee(()=>+m.height,i=>F("update:height",i)),N=p(()=>{var i,f;return{min:(i=m.anchors[0])!=null?i:100,max:(f=m.anchors[m.anchors.length-1])!=null?f:Math.round(Oe.value*.6)}}),g=p(()=>m.anchors.length>=2?m.anchors:[N.value.min,N.value.max]),B=T(!1),u=p(()=>({height:fe(N.value.max),transform:`translateY(calc(100% + ${fe(-b.value)}))`,transition:B.value?"none":`transform ${m.duration}s cubic-bezier(0.18, 0.89, 0.32, 1.28)`})),z=i=>{const f=Math.abs(i),{min:l,max:r}=N.value;return f>r?-(r+(f-r)*.2):f<l?-(l-(l-f)*.2):i};let A,x=-1;const U=Qe(),L=i=>{U.start(i),B.value=!0,A=-b.value,x=-1},S=i=>{var f;U.move(i);const l=i.target;if(c.value===l||(f=c.value)!=null&&f.contains(l)){const{scrollTop:P}=c.value;if(x=Math.max(x,P),!m.contentDraggable)return;if(-A<N.value.max)Ye(i,!0);else if(!(P<=0&&U.deltaY.value>0)||x>0)return}const r=U.deltaY.value+A;b.value=-z(r)},R=()=>{x=-1,B.value=!1,b.value=he(g.value,b.value),b.value!==-A&&F("heightChange",{height:b.value})};Ve(N,()=>{b.value=he(g.value,b.value)},{immediate:!0}),ze(k,()=>m.lockScroll||B.value),Ke("touchmove",S,{target:k});const K=()=>s.header?s.header():w("div",{class:V("header")},[w("div",{class:V("header-bar")},null)]);return()=>{var i;return w("div",{class:[V(),{"van-safe-area-bottom":m.safeAreaInsetBottom}],ref:k,style:u.value,onTouchstartPassive:L,onTouchend:R,onTouchcancel:R},[K(),w("div",{class:V("content"),ref:c},[(i=s.default)==null?void 0:i.call(s)])])}}});function Ne(m,F){return nt(st,m)}const kt={class:"h-screen flex flex-col font-[dinpro]"},Nt={class:"bg-[#2A2B30] mb-0 rounded-lg overflow-hidden m-3 border-bg"},Pt={class:"relative"},Ct={class:"py-2 px-3 home-bg flex justify-between"},It={class:"px-3 py-2 flex"},Bt=["src"],At={key:1,class:"w-20 h-20 animate-pulse rounded-full bg-white/50"},Ut={class:"pl-3 text-sm text-white/80 flex-1 grid grid-cols-2 content-start"},Tt={class:""},Ft={class:"text-right"},Mt={class:""},$t={class:"text-right"},qt={class:"text-theme"},Lt={key:0,class:"flex items-center justify-between mt-1 col-span-2"},St={class:"font-bold text-lg rounded lucky px-2 flex items-center justify-center"},Rt={class:"text-lg font-bold p-3"},Dt={class:"flex-1 overflow-hidden flex flex-col"},Ht={class:"flex justify-between mb-2 px-3"},jt={class:"flex-1 overflow-auto px-3"},Et={class:"divide-y divide-[#2A2B30] text-white/80"},Ot={class:"px-3 py-2"},Qt={class:"flex items-center border border-white/20 rounded-lg py-1 px-2 mb-3"},Vt=["src"],zt={class:"grid grid-cols-3 gap-2 mb-3"},Kt=["onClick"],Yt={class:"text-xs mb-3"},Jt=["disabled"],Wt={key:1},Gt=["disabled"],Xt={key:1},ee=30n,Zt=Pe({__name:"info",setup(m){const{openExplorer:F}=mt(),{t:s}=Je(),{address:M}=We();bt({title:"UU竞拍 - 专属竞拍详情",ogTitle:"UU竞拍 | 竞争激烈的实时下注",description:"参与UU去中心化竞拍，查看实时下注情况，计算获胜概率，随时掌握竞拍动态。",ogDescription:"正在进行中的热门竞拍！查看实时下注情况，计算您的中奖概率。在UU竞拍平台，小额投入也有机会赢取ETH和热门代币，透明公正的链上竞争，立即参与！"});const k=Ge(),c=ht(),{tokenAddressMap:b}=ft(),{addBetRecord:N}=gt(),g=p(()=>BigInt(k.query.id||0)),B=p(()=>a=>{var _;const n=Number(((_=u.value)==null?void 0:_.drawNum)||0);return n>=a.start&&n<=a.end?"lucky rounded border-none text-black":""}),{data:u,refetch:z}=Ne({queryKey:p(()=>["auctionInfo",k.query.id]),queryFn:async()=>{const a={user:"",award:"",total:0,pour:0,drawNum:0},n=await c.auctionInfo(g.value);return a.user=n[0],a.award=n[1],a.total=Number(n[2]),a.pour=Number(n[3]),n[2]==n[3]&&(a.drawNum=Number(await c.drawNum(g.value))),a}}),A=p(()=>!u.value||!x.value?0:Number(x.value||0)/(Number(u.value.total)||1)*100),{data:x,refetch:U}=Ne({queryKey:p(()=>["pourNum",k.query.id]),queryFn:async()=>c.pourNum(g.value,M.value),enabled:p(()=>!!M.value)}),{data:L,refetch:S,isRefetching:R,isFetching:K,hasNextPage:i,fetchNextPage:f}=ot({enabled:p(()=>!!M.value),queryKey:p(()=>["getPourList",k.query.id]),refetchOnWindowFocus:!1,initialPageParam:1,getNextPageParam:a=>a.nextCursor,queryFn:async({pageParam:a=1})=>{const n=await c.getPourList(g.value,BigInt(a),ee),_={list:n[1].map(I=>({...I,amount:Number(I.end-I.start)+1,start:Number(I.start),end:Number(I.end)})),nextCursor:void 0};return(a-1)*Number(ee)+n[1].length<Number(n[0])&&(_.nextCursor=a+1),_}}),l=pt("UB"),r=T(null),P=T(!1),D=[100,300],H=T(D[0]),Ce=[1,5,10,50,100,500],{setShowMenu:Y}=Xe();Ze(()=>{M.value&&(l.balanceOf(),l.allowance(c.address.value),console.log("ubToken",l.allowanceMap.value[c.address.value]))});const Ie=p(()=>(l.allowanceMap.value[c.address.value]||0n)<_e(r.value||0,l.tokenInfo.value.decimals)),{isPending:te,mutateAsync:Be}=ke({mutationFn:async a=>{await l.approve(c.address.value,_e(a,l.tokenInfo.value.decimals)),await l.allowance(c.address.value)}}),Ae=()=>{Y(!1),H.value=D[1]},Ue=({height:a})=>{Y(a==D[0])};et(()=>{Y(!0)});const{isPending:J,mutateAsync:Te}=ke({mutationFn:async()=>{var n,_;if(xe(l.balance.value,l.tokenInfo.value.decimals)<Number(r.value||0)){ge("余额不足");return}if(Number((n=u.value)==null?void 0:n.total)-Number((_=u.value)==null?void 0:_.pour)<Number(r.value||0)){ge("剩余数量不足");return}const a=vt({message:s("确认中")+"...",duration:0});try{P.value=!1,await c.pourAuction(BigInt(g.value),BigInt(r.value||0)),N(Number(g.value)),r.value=null,z(),S(),U(),l.balanceOf(),l.allowance(c.address.value),a.open({type:"success",message:s("下注成功"),duration:2e3})}catch(j){a.open({type:"error",message:j.shortMessage||s("下注失败"),duration:2e3})}}});return(a,n)=>{var ne,se,oe,le,re,ue,ie,de,ce;const _=Se,j=at,I=rt,Fe=ut,Me=lt,$e=ct,ae=Re,qe=xt,Le=dt;return d(),v("div",kt,[w(_,{title:e(s)("详情")},null,8,["title"]),t("div",Nt,[t("div",Pt,[t("div",Ct,[t("span",null,"# "+o(e(g)),1),t("span",{onClick:n[0]||(n[0]=tt(y=>{var C;return e(F)("address",(C=e(u))==null?void 0:C.award)},["stop"]))},[t("span",null,o(e(s)("奖品"))+": "+o(("addressFl"in a?a.addressFl:e(ye))((ne=e(u))==null?void 0:ne.award)),1),w(j,{"class-prefix":"iconfont icon-jump text-white/60 ml-1"})])]),t("div",It,[t("div",null,[(se=e(u))!=null&&se.award?(d(),v("img",{key:0,class:"w-20 h-20",src:e(b)[(oe=e(u))==null?void 0:oe.award].icon,alt:""},null,8,Bt)):(d(),v("div",At))]),t("div",Ut,[t("div",Tt,[t("span",null,o(e(s)("总筹码"))+": ",1),t("span",null,o((le=e(u))==null?void 0:le.total),1)]),t("div",Ft,[t("span",null,o(e(s)("总下注"))+": ",1),t("span",null,o((re=e(u))==null?void 0:re.pour),1)]),t("div",Mt,[t("span",null,o(e(s)("已下注"))+": ",1),t("span",null,o(e(x)),1)]),t("div",$t,[t("span",null,o(e(s)("概率"))+": ",1),t("span",qt,o(("formatNumber"in a?a.formatNumber:e(we))(e(A),0,2))+"%",1)]),(ue=e(u))!=null&&ue.drawNum?(d(),v("div",Lt,[t("div",null,o(e(s)("幸运数")),1),t("div",St,o((ie=e(u))==null?void 0:ie.drawNum),1)])):pe("",!0)])])])]),t("div",Rt,o(e(s)("下注记录")),1),t("div",Dt,[t("div",Ht,[t("div",null,o(e(s)("排序")),1),t("div",null,o(e(s)("地址")),1),t("div",null,o(e(s)("数量")),1)]),t("div",jt,[w(Me,{"model-value":e(R),onRefresh:e(S)},{default:G(()=>{var y,C;return[((C=(y=e(L))==null?void 0:y.pages[0])==null?void 0:C.list.length)===0?(d(),O(I,{key:0,image:"/empty.png",description:e(s)("暂无下注记录")},null,8,["description"])):(d(),O(Fe,{key:1,loading:e(K),finished:!e(i),"loading-text":e(s)("加载中")+"...","finished-text":e(s)("没有更多了"),onLoad:e(f)},{default:G(()=>{var $;return[t("div",Et,[(d(!0),v(Q,null,Z(($=e(L))==null?void 0:$.pages,(E,q)=>(d(),v(Q,{key:q},[(d(!0),v(Q,null,Z(E.list,(h,W)=>(d(),v("div",{key:W,class:be(["flex justify-between my-2 py-1 px-3",e(B)(h)])},[t("div",null,o(q*Number(ee)+W+1),1),t("div",null,o(("addressFl"in a?a.addressFl:e(ye))(h.user)),1),t("div",null,o(h.amount),1)],2))),128))],64))),128))])]}),_:1},8,["loading","finished","loading-text","finished-text","onLoad"]))]}),_:1},8,["model-value","onRefresh"]),n[7]||(n[7]=t("div",{class:"h-[100px]"},null,-1))])]),t("div",null,[w(qe,{height:e(H),"onUpdate:height":n[5]||(n[5]=y=>X(H)?H.value=y:null),anchors:D,onHeightChange:Ue,class:"!z-10"},{default:G(()=>{var y,C,$,E,q;return[t("div",Ot,[t("div",Qt,[w($e,{onFocus:n[1]||(n[1]=h=>Ae()),modelValue:e(r),"onUpdate:modelValue":n[2]||(n[2]=h=>X(r)?r.value=h:null),class:"bg-transparent flex-1",placeholder:e(s)("请输入投入数量")},null,8,["modelValue","placeholder"]),(y=e(u))!=null&&y.award?(d(),v("img",{key:0,class:"w-8 h-8",src:e(l).tokenInfo.value.icon,alt:""},null,8,Vt)):pe("",!0)]),t("div",null,[t("div",zt,[(d(),v(Q,null,Z(Ce,h=>t("button",{key:h,class:"px-2 py-1 bg-transparent text-white border border-white/20 rounded",onClick:W=>r.value=Number(e(r))+h}," + "+o(h),9,Kt)),64))])]),t("div",Yt,o(e(s)("账户筹码"))+": "+o(("formatNumber"in a?a.formatNumber:e(we))(("formatUnit"in a?a.formatUnit:e(xe))(e(l).balance.value))),1),e(Ie)?(d(),v("button",{key:0,class:"btn-bg w-full h-9 bg-white text-black rounded-full font-bold",onClick:n[3]||(n[3]=h=>P.value=!0),disabled:e(te)||Number(e(r)||0)<=0},[e(te)?(d(),O(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Wt,o(e(s)("授权"))+" "+o(($=(C=e(l))==null?void 0:C.tokenInfo.value)==null?void 0:$.symbol),1))],8,Jt)):(d(),v("button",{key:1,class:be(["btn-bg w-full h-9 bg-white text-black rounded-full font-bold",{"opacity-50":e(J)||Number(e(r)||0)<=0||!!((E=e(u))!=null&&E.drawNum)}]),onClick:n[4]||(n[4]=h=>e(Te)()),disabled:e(J)||Number(e(r)||0)<=0||!!((q=e(u))!=null&&q.drawNum)},[e(J)?(d(),O(ae,{key:0,type:"spinner",color:"#000"})):(d(),v("span",Xt,o(e(s)("下注")),1))],10,Gt))])]}),_:1},8,["height"])]),w(Le,{show:e(P),"onUpdate:show":n[6]||(n[6]=y=>X(P)?P.value=y:null),address:(ce=(de=e(l))==null?void 0:de.tokenInfo.value)==null?void 0:ce.address,amount:e(r)||0,approve:e(Be)},null,8,["show","address","amount","approve"])])}}}),va=_t(Zt,[["__scopeId","data-v-454af9bf"]]);export{va as default};

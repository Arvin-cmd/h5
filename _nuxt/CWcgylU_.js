import{L as re,_ as de,s as ue}from"./Ct7Ffzkv.js";import{_ as fe,a as pe,s as I,b as me}from"./DCXi3YRt.js";import{e as ne,f as ve,g as _e,b as i,m as he,p as ke,P as be,I as R,H as we,h as xe,i as U,j as ge,k as ye,n as Ie,l as Ce,u as Ae,q as Ue,r as Se,s as F,v as Pe,x as Q,y as W,c as w,a,z as e,t as f,A as X,B as Be,C as S,D as Y,E as Z,w as Te,o as v,F as $e,G as De,J as ee}from"./du6FXzWk.js";import{o as He,a as te}from"./CijhgYeQ.js";import{t as Ee,u as se,s as Fe,c as Oe}from"./Cy-h5_cU.js";import{u as Ne}from"./di251i34.js";import{u as oe}from"./Cb3vITa0.js";import{a as Le}from"./D1nuaBJH.js";import"./DlAUqK2U.js";import"./s7WYq-nx.js";const[Me,p]=_e("action-sheet"),Ve=ve({},xe,{title:String,round:U,actions:ye(),closeIcon:ge("cross"),closeable:U,cancelText:String,description:String,closeOnPopstate:U,closeOnClickAction:Boolean,safeAreaInsetBottom:U}),je=[...Ce,"round","closeOnPopstate","safeAreaInsetBottom"];var Ke=ne({name:Me,props:Ve,emits:["select","cancel","update:show"],setup(u,{slots:r,emit:l}){const x=n=>l("update:show",n),m=()=>{x(!1),l("cancel")},P=()=>{if(u.title)return i("div",{class:p("header")},[u.title,u.closeable&&i(R,{name:u.closeIcon,class:[p("close"),we],onClick:m},null)])},B=()=>{if(r.cancel||u.cancelText)return[i("div",{class:p("gap")},null),i("button",{type:"button",class:p("cancel"),onClick:m},[r.cancel?r.cancel():u.cancelText])]},h=n=>{if(n.icon)return i(R,{class:p("item-icon"),name:n.icon},null)},g=(n,k)=>n.loading?i(re,{class:p("loading-icon")},null):r.action?r.action({action:n,index:k}):[i("span",{class:p("name")},[n.name]),n.subname&&i("div",{class:p("subname")},[n.subname])],d=(n,k)=>{const{color:T,loading:_,callback:C,disabled:y,className:$}=n,A=()=>{y||_||(C&&C(n),u.closeOnClickAction&&x(!1),Ie(()=>l("select",n,k)))};return i("button",{type:"button",style:{color:T},class:[p("item",{loading:_,disabled:y}),$],onClick:A},[h(n),g(n,k)])},t=()=>{if(u.description||r.description){const n=r.description?r.description():u.description;return i("div",{class:p("description")},[n])}};return()=>i(be,he({class:p(),position:"bottom","onUpdate:show":x},ke(u,je)),{default:()=>{var n;return[P(),t(),i("div",{class:p("content")},[u.actions.map(d),(n=r.default)==null?void 0:n.call(r)]),B()]}})}});const ze={class:"h-screen w-screen flex flex-col"},qe={class:"mb-[20vw] flex-1 flex flex-col justify-center px-4"},Ge={class:"border-bg rounded-lg bg-white/30 p-3"},Je={class:"relative"},Re={class:"text-xl font-bold text-center my-4"},Qe={class:"mt-6 border border-white/30 rounded-md px-2 py-1 flex items-center"},We={class:"text-white/60"},Xe=["src"],Ye={class:"text-sm mr-4"},Ze=["src"],et={class:"text-xs text-white/60 pl-3"},tt={class:"text-xs text-white/60 ml-auto pr-2"},st={class:"flex items-center mt-2"},ot={class:"pr-2 ml-auto"},nt=["src"],at={class:"mt-6"},lt=["disabled"],ct={key:1},it={key:1},rt={class:"p-4 divide-y divide-white/20"},dt=["onClick"],ut=["src"],ft={class:"text-xs pl-2 flex-1"},pt={class:"text-xs ml-auto pr-2"},It=ne({__name:"add",setup(u){const{openExplorer:r}=He(),{t:l}=Ae(),{address:x}=Ue();Le({title:"UU竞拍 - 创建您的专属竞拍",ogTitle:"UU竞拍 | 成为庄家，开启您的区块链生意",description:"在UU竞拍平台创建您的专属竞拍活动，成为庄家，自定义奖品和规则，吸引玩家参与。",ogDescription:"想当老板？在UU竞拍平台创建您的专属竞拍，自由设置奖品代币和开奖条件。成为庄家，享受设定规则的乐趣，同时获得参与者的关注。区块链技术保证公平透明，立即开启您的第一场竞拍！"});const m=Ne(),{tokenList:P}=Ee(),B=["USDT"],h=oe("UB");Se(()=>{x.value&&(h.balanceOf(),h.allowance(m.address.value))});const g=F(!1),d=Pe({award:h.tokenInfo.value.address,total:null}),t=F({...h}),n=P.value.filter(s=>!B.includes(s==null?void 0:s.symbol)).map(s=>oe(s==null?void 0:s.symbol)),k=Q(()=>{var s;return d.total?((s=t.value.tokenInfo)==null?void 0:s.symbol)=="UB"?d.total:1:0}),T=Q(()=>{const s=W(t.value.allowanceMap[m.address.value]||0n,t.value.tokenInfo.decimals);return Number(s)>=k.value}),_=F(!1),C=async s=>{d.award=s.tokenInfo.value.address,t.value=s,_.value=!1,x.value&&(s.balance.value||await s.balanceOf(),s.allowanceMap.value[m.address.value]||await s.allowance(m.address.value))},{isPending:y,mutateAsync:$}=se({mutationFn:async s=>{var o,b;if(!s){I("请输入有效金额");return}await((o=t.value)==null?void 0:o.approve(m.address.value,ee(s.toString(),t.value.tokenInfo.decimals))),await((b=t.value)==null?void 0:b.allowance(m.address.value))}}),{isPending:A,mutate:ae}=se({mutationFn:async()=>{var b;const{award:s,total:o}=d;if(!o)return I(l("请输入开奖数量"));if(o<5)return I(l("开奖筹码数量不能少于")+"5");if(t){const D=((b=t.value.tokenInfo)==null?void 0:b.symbol)=="UB"?o:1;if(ee(D.toString(),t.value.tokenInfo.decimals)>t.value.balance)return I(l("筹码余额不足"));try{await Fe({title:l("温馨提示"),messageAlign:"left",message:l("一旦创建成功")+"，"+l("就不能取消了")+"，"+l("必须等到开奖后才能取回未开奖的筹码")+"。"}),await m.userAddAuction(s,BigInt(o)),me(l("创建成功")),t.value.balanceOf(),t.value.allowance(m.address.value),d.total=null}catch{I(l("创建失败"))}}else return I("错误代币");Oe()}});return(s,o)=>{var O,N,L,M,V,j,K;const b=de,D=fe,H=Be,E=ue,le=pe,ce=Ke;return v(),w("div",ze,[i(b,{title:e(l)("创建拍卖")},null,8,["title"]),a("div",qe,[o[7]||(o[7]=a("div",{class:"text-center text-xl mb-4"},"Create Auction",-1)),a("div",Ge,[a("div",Je,[a("div",Re,f(e(l)("创建拍卖")),1),a("div",Qe,[a("div",We,f(e(l)("开奖筹码")),1),i(D,{modelValue:e(d).total,"onUpdate:modelValue":o[0]||(o[0]=c=>e(d).total=c),class:"bg-transparent text-white flex-1 w-1 text-right h-10",placeholder:"0"},null,8,["modelValue"]),a("img",{class:"w-10 h-10 ml-3",src:e(h).tokenInfo.value.icon,alt:""},null,8,Xe)]),a("div",{class:"flex items-center my-3 border border-white/30 rounded-md px-2 py-1",onClick:o[2]||(o[2]=c=>_.value=!0)},[a("div",Ye,f(e(l)("奖品选择")),1),a("img",{class:"w-8 h-8",src:e(t).tokenInfo.icon,alt:""},null,8,Ze),a("div",et,f((O=e(t).tokenInfo)==null?void 0:O.symbol),1),a("div",tt,f(e(te)(e(t).tokenInfo.address)),1),i(H,{"class-prefix":"iconfont icon-jump text-white/60",onClick:o[1]||(o[1]=X(c=>e(r)("address",e(t).tokenInfo.address),["stop"]))})]),a("div",st,[a("div",null,f(e(l)("余额"))+":",1),a("div",ot,"x "+f(e(W)((N=e(t))==null?void 0:N.balance,(M=(L=e(t))==null?void 0:L.tokenInfo)==null?void 0:M.decimals)),1),a("img",{class:"w-5 h-5",src:(V=e(t).tokenInfo)==null?void 0:V.icon,alt:""},null,8,nt)]),a("div",at,[e(T)?(v(),w("button",{key:1,class:S(["btn-bg text-black rounded-full w-full h-10 font-bold",{"opacity-50":e(A)||!e(d).total}]),onClick:o[4]||(o[4]=c=>e(ae)())},[e(A)?(v(),Y(E,{key:0,type:"spinner",color:"#000"})):(v(),w("span",it,f(e(l)("创建")),1))],2)):(v(),w("button",{key:0,class:S(["btn-bg w-full h-10 text-black rounded-full font-bold",{"opacity-50":e(y)||!e(d).total}]),onClick:o[3]||(o[3]=c=>g.value=!0),disabled:e(y)||Number(e(d).total)<=0},[e(y)?(v(),Y(E,{key:0,type:"spinner",color:"#000"})):(v(),w("span",ct,f(e(l)("授权"))+" "+f((j=e(t).tokenInfo)==null?void 0:j.symbol),1))],10,lt))])])])]),i(le,{show:e(g),"onUpdate:show":o[5]||(o[5]=c=>Z(g)?g.value=c:null),address:(K=e(d))==null?void 0:K.award,amount:e(k),approve:e($)},null,8,["show","address","amount","approve"]),i(ce,{show:e(_),"onUpdate:show":o[6]||(o[6]=c=>Z(_)?_.value=c:null),title:e(l)("选择奖品代币")},{default:Te(()=>[a("div",rt,[(v(!0),w($e,null,De(e(n),c=>{var z,q,G;return v(),w("div",{class:S(["flex items-center py-2",{"text-white/60":c.tokenInfo.value.address!==e(t).tokenInfo.address}]),key:c.tokenInfo.value.address,onClick:ie=>C(c)},[a("img",{class:S(["w-8 h-8",{grayscale:c.tokenInfo.value.address!==e(t).tokenInfo.address}]),src:(z=c.tokenInfo.value)==null?void 0:z.icon,alt:""},null,10,ut),a("div",ft,f((q=c.tokenInfo.value)==null?void 0:q.symbol),1),a("div",pt,f(e(te)((G=c.tokenInfo.value)==null?void 0:G.address)),1),i(H,{"class-prefix":"iconfont icon-jump",onClick:X(ie=>{var J;return e(r)("address",(J=c.tokenInfo.value)==null?void 0:J.address)},["stop"])},null,8,["onClick"])],10,dt)}),128))])]),_:1},8,["show","title"])])}}});export{It as default};
